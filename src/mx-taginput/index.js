define("mx-taginput/index",["magix","$","./suggest"],(e,t,i)=>{e("./suggest");let s=e("magix");s.applyStyle("_J","._fd{height:auto;min-height:32px;padding:1px 7px;position:relative;border:1px solid #e6e6e6;border-radius:4px;width:340px;line-height:1}._fd:hover{border-color:#ccc}._fe{cursor:not-allowed;background-color:#fbfbfb}._fe:hover{border-color:#e6e6e6}._ff{height:auto;cursor:text}._fg{position:absolute;left:9px;top:8px;color:#999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}._fh{position:relative;display:inline-block;margin:1px;cursor:pointer;background-color:#eee;border-radius:4px}._fi{width:1px;visibility:hidden}._fj{float:left;border-right:1px solid #fff;max-width:200px;overflow:hidden}._fk,._fj{height:24px;line-height:24px;padding:0 4px}._fk{width:20px;font-weight:bolder;text-align:center;color:#999;display:inline-block}._fl{border:none;outline:none;height:24px;line-height:24px;padding:0;width:20px;position:relative;z-index:1;background:transparent}._fe ._ff,._fe ._fk,._fe ._fj,._fe ._fl{cursor:not-allowed}");let _=e("$");i.exports=s.View.extend({tmpl:{html:'<div mx-guid="g0" class="_ff _aj" mx-click="__fP()" id="ipt_<%=$$.viewId%>">1</div>',subs:[{keys:["viewId","items","placeholder","textKey"],path:'div[mx-guid="g0"]',tmpl:'<%if(!$$.items.length&&$$.placeholder){%><div class="_fg"><%=$$.placeholder%></div><%}if($$.items.length){for(var _=0;_<$$.items.length;_++){var a=$$.items[_];%><div class="_fh" mx-contextmenu="prevent()"><div class="_fj _al"><%=$$.textKey?a[$$.textKey]:a%></div><div class="_fk" mx-click="__fN({idx:<%!_%>})">x</div></div><%}}else{%><div class="_fh _fi" mx-click="stop()"><div class="_fk" mx-click="__fN({idx:<%!_%>})">x</div></div><%}%><input mx-guid="g2" mx-keydown="__fO()" mx-keyup="__fO()" mx-input="__fO()" mx-paste="__fO()" mx-pick="__k()" mx-change="__bY()" mx-focusin="__bY()" mx-focusout="__bY()" mx-showlist="__fQ()" mx-hidelist="__fQ()" <%if(!$$.disabled){%> mx-view="mx-taginput/suggest?list=<%@$$.list%>&textKey=<%@$$.textKey%>&valueKey=<%@$$.valueKey%>&relateIds=ipt_<%!$eu($$.viewId)%>&offsetLeft=-11&width=<%!$eu($$.width)%>&scrollTop=<%@$$.scrollTop%>" <%}else{%> disabled="disabled" <%}%> class="_fl" autocomplete="off">',s:"1",attr:'id="ipt_<%=$$.viewId%>"',attrs:[{n:"id",p:1}],mask:"3111"},{keys:["disabled","list","valueKey","viewId","width","scrollTop"],path:'input[mx-guid="g2"]',pKeys:["items","placeholder","textKey"],attr:'<%if(!$$.disabled){%> mx-view="mx-taginput/suggest?list=<%@$$.list%>&textKey=<%@$$.textKey%>&valueKey=<%@$$.valueKey%>&relateIds=ipt_<%!$eu($$.viewId)%>&offsetLeft=-11&width=<%!$eu($$.width)%>&scrollTop=<%@$$.scrollTop%>" <%}else{%> disabled="disabled" <%}%>',attrs:[{n:"mx-view",v:1},{n:"disabled",b:1,p:1}]}]},init(e){let t=this;t.__eu=e.list||[],t.__h=_("#"+t.id),t.updater.set({disabled:e.disabled,placeholder:e.placeholder||"",textKey:e.textKey,valueKey:e.valueKey}),t.__fH(e.selected)},__fI(){let e=this.updater,t=e.get("sMap"),i=e.get("valueKey"),s=this.__eu,_=[];for(let e,l,d=0;d<s.length;d++)e=s[d],t[l=i?e[i]:e]||_.push(e);return _},render(){let e=this,t=_("#"+e.id),i=t.outerWidth();0===i&&(i=340),e.updater.digest({width:i,list:e.__fI(),viewId:e.id}),t.addClass("_fd"),e.__dK=t,e.__fJ();e.updater.get().disabled&&t.addClass("_fe")},__fJ(){let e=this,t=e.__dK;e.__fK=t.find("input"),e.__fK.width(20);let i=_("#ipt_"+e.id).width()-e.__fK.position().left;e.__fK.width(i>=20?i:20)},__fH(e){e=((e=e||"")+"").split(",");let t=[],i={},_=this.updater.get("valueKey"),l=this.__eu,d=s.toMap(e);for(let e,a,o=0;o<l.length;o++)e=l[o],a=_?e[_]:e,s.has(d,a)&&(i[a]=1,t.push(e));this.updater.set({sMap:i,items:t}),this.__h.val(e.join(","))},val(e){let t=this;return e&&(t.__fH(e),t.updater.digest({list:t.__fI()}),t.__fJ(),t.__dK.removeClass("_ar"),t.__u()),t.updater.get("items")},__u(){let e=this.updater,t=[],i=e.get("items"),s=e.get("valueKey");for(let e,_=0;_<i.length;_++)e=i[_],t.push(s?e[s]:e);_("#"+this.id).val(t.join(",")).trigger({type:"change",ids:t,items:i})},__fM(){let e=this;clearTimeout(e.__fL),e.__ee=!0,e.__fK.focus(),e.__fL=setTimeout(e.wrapAsync(()=>{delete e.__ee}),20)},"__fO<keydown,input,paste,keyup>"(e){e.stopPropagation();let t=this,i=e.eventTarget.value;if(t.__cd!==i){t.__cd=i;let e=t.__dK.find("._fg");i?e.hide():e.show()}if(!i&&"keydown"==e.type&&8==e.keyCode){let e=t.updater.get("items").length-1;e>-1&&(t["__fN<click>"]({params:{idx:e}}),t.__fM())}},"__k<pick>"(e){e.stopPropagation();let t=this,i=t.updater,s=i.get("items"),_=i.get("sMap"),l=e.item,d=i.get("valueKey"),a=d?l[d]:l;_[a]||(_[a]=1,s.push(l),i.digest({items:s,scrollTop:e.scrollTop,list:t.__fI()}),t.__fJ(),t.__fM(),t.__u())},"__fP<click>"(){let e=this;e.__h.hasClass("_fe")||e.__fK.focus()},"__fN<click>"(e){let t=this;if(t.__h.hasClass("_fe"))return;let i=t.updater,s=i.get("items"),_=i.get("sMap"),l=i.get("valueKey"),d=s[e.params.idx];delete _[l?d[l]:d],s.splice(e.params.idx,1),i.digest({items:s,list:t.__fI()}),t.__fJ(),t.__u(),t.__fM()},"__D<contextmenu>"(e){e.preventDefault()},"__bY<change,focusin,focusout>"(e){e.stopPropagation();let t=this.__dK;"focusin"==e.type&&t.addClass("_ar")},"__fQ<showlist,hidelist>"(e){if(!this.__ee&&(_("#"+this.id).trigger({type:"showlist"==e.type?"focusin":"focusout"}),"hidelist"==e.type)){this.__dK.removeClass("_ar")}}})});