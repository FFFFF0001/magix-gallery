define("mx-taginput/index",["magix","$","./suggest"],function(e,t,i){e("./suggest");var s=e("magix");s.applyStyle("H",".fl{height:auto;min-height:32px;padding:1px 7px;position:relative;border:1px solid #e6e6e6;border-radius:4px;width:340px;line-height:1}.fl:hover{border-color:#ccc}.fm{cursor:not-allowed;background-color:#fbfbfb}.fm:hover{border-color:#e6e6e6}.fn{height:auto;cursor:text}.fo{position:absolute;left:9px;top:8px;color:#999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fp{position:relative;display:inline-block;margin:1px;cursor:pointer;background-color:#eee;border-radius:4px}.fq{width:1px;visibility:hidden}.fr{float:left;border-right:1px solid #fff;max-width:200px;overflow:hidden}.fs,.fr{height:24px;line-height:24px;padding:0 4px}.fs{width:20px;font-weight:bolder;text-align:center;color:#999;display:inline-block}.ft{border:none;outline:none;height:24px;line-height:24px;padding:0;width:20px;position:relative;z-index:1;background:transparent}.fm .fn,.fm .fs,.fm .fr,.fm .ft{cursor:not-allowed}");var d=e("$");i.exports=s.View.extend({tmpl:{html:'<div mx-guid="g0" class="fn ah" mx-click="__fr()" id="ipt_<%=$$.viewId%>">1</div>',subs:[{keys:["viewId","items","placeholder","textKey"],path:'div[mx-guid="g0"]',tmpl:'<%if(!$$.items.length&&$$.placeholder){%><div class="fo"><%=$$.placeholder%></div><%}if($$.items.length){for(var a=0;a<$$.items.length;a++){var b=$$.items[a];%><div class="fp" mx-contextmenu="prevent()"><div class="fr aj"><%=$$.textKey?b[$$.textKey]:b%></div><div class="fs" mx-click="__fp({idx:<%!a%>})">x</div></div><%}}else{%><div class="fp fq" mx-click="stop()"><div class="fs" mx-click="__fp({idx:<%!a%>})">x</div></div><%}%><input mx-guid="g2" mx-keydown="__fq()" mx-keyup="__fq()" mx-input="__fq()" mx-paste="__fq()" mx-pick="__k()" mx-change="__bQ()" mx-focusin="__bQ()" mx-focusout="__bQ()" mx-showlist="__fs()" mx-hidelist="__fs()" <%if(!$$.disabled){%> mx-view="mx-taginput/suggest?list=<%@$$.list%>&textKey=<%@$$.textKey%>&valueKey=<%@$$.valueKey%>&relateIds=ipt_<%!$eu($$.viewId)%>&offsetLeft=-11&width=<%!$eu($$.width)%>&scrollTop=<%@$$.scrollTop%>" <%}else{%> disabled="disabled" <%}%> class="ft" autocomplete="off">',s:"1",attr:'id="ipt_<%=$$.viewId%>"',attrs:[{n:"id",p:1}],mask:"3111"},{keys:["disabled","list","valueKey","viewId","width","scrollTop"],path:'input[mx-guid="g2"]',pKeys:["items","placeholder","textKey"],attr:'<%if(!$$.disabled){%> mx-view="mx-taginput/suggest?list=<%@$$.list%>&textKey=<%@$$.textKey%>&valueKey=<%@$$.valueKey%>&relateIds=ipt_<%!$eu($$.viewId)%>&offsetLeft=-11&width=<%!$eu($$.width)%>&scrollTop=<%@$$.scrollTop%>" <%}else{%> disabled="disabled" <%}%>',attrs:[{n:"mx-view",v:1},{n:"disabled",b:1,p:1}]}]},init:function(e){var t=this;t.__ed=e.list||[],t.__h=d("#"+t.id),t.updater.set({disabled:e.disabled,placeholder:e.placeholder||"",textKey:e.textKey,valueKey:e.valueKey}),t.__fj(e.selected)},__fk:function(){for(var e=this,t=e.updater,i=t.get("sMap"),s=t.get("valueKey"),d=e.__ed,a=[],l=0,o=void 0;l<d.length;l++)o=d[l],i[s?o[s]:o]||a.push(o);return a},render:function(){var e=this,t=d("#"+e.id),i=t.outerWidth();0===i&&(i=340),e.updater.digest({width:i,list:e.__fk(),viewId:e.id}),t.addClass("fl"),e.__dA=t,e.__fl(),e.updater.get().disabled&&t.addClass("fm")},__fl:function(){var e=this,t=e.__dA;e.__fm=t.find("input"),e.__fm.width(20);var i=d("#ipt_"+e.id).width()-e.__fm.position().left;e.__fm.width(i>=20?i:20)},__fj:function(e){var t=this;e=((e=e||"")+"").split(",");for(var i=[],d={},a=t.updater.get("valueKey"),l=t.__ed,o=s.toMap(e),_=0,r=void 0,f=void 0;_<l.length;_++)r=l[_],f=a?r[a]:r,s.has(o,f)&&(d[f]=1,i.push(r));t.updater.set({sMap:d,items:i}),t.__h.val(e.join(","))},val:function(e){var t=this;return e&&(t.__fj(e),t.updater.digest({list:t.__fk()}),t.__fl(),t.__dA.removeClass("ap"),t.__u()),t.updater.get("items")},__u:function(){for(var e=this,t=e.updater,i=[],s=t.get("items"),a=t.get("valueKey"),l=0,o=void 0;l<s.length;l++)o=s[l],i.push(a?o[a]:o);d("#"+e.id).val(i.join(",")).trigger({type:"change",ids:i,items:s})},__fo:function(){var e=this;clearTimeout(e.__fn),e.__dR=!0,e.__fm.focus(),e.__fn=setTimeout(e.wrapAsync(function(){delete e.__dR}),20)},"__fq<keydown,input,paste,keyup>":function(e){e.stopPropagation();var t=this,i=e.eventTarget.value;if(t.__bW!==i){t.__bW=i;var s=t.__dA.find(".fo");i?s.hide():s.show()}if(!i&&"keydown"==e.type&&8==e.keyCode){var d=t.updater.get("items").length-1;d>-1&&(t["__fp<click>"]({params:{idx:d}}),t.__fo())}},"__k<pick>":function(e){e.stopPropagation();var t=this,i=t.updater,s=i.get("items"),d=i.get("sMap"),a=e.item,l=i.get("valueKey"),o=l?a[l]:a;d[o]||(d[o]=1,s.push(a),i.digest({items:s,scrollTop:e.scrollTop,list:t.__fk()}),t.__fl(),t.__fo(),t.__u())},"__fr<click>":function(){var e=this;e.__h.hasClass("fm")||e.__fm.focus()},"__fp<click>":function(e){var t=this;if(!t.__h.hasClass("fm")){var i=t.updater,s=i.get("items"),d=i.get("sMap"),a=i.get("valueKey"),l=s[e.params.idx];delete d[a?l[a]:l],s.splice(e.params.idx,1),i.digest({items:s,list:t.__fk()}),t.__fl(),t.__u(),t.__fo()}},"__D<contextmenu>":function(e){e.preventDefault()},"__bQ<change,focusin,focusout>":function(e){e.stopPropagation();var t=this.__dA;"focusin"==e.type&&t.addClass("ap")},"__fs<showlist,hidelist>":function(e){this.__dR||(d("#"+this.id).trigger({type:"showlist"==e.type?"focusin":"focusout"}),"hidelist"==e.type&&this.__dA.removeClass("ap"))}})});