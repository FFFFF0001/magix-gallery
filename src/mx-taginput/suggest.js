define("mx-taginput/suggest",["magix","$","../mx-monitor/index"],function(_,e,t){var i=_("magix"),r=_("$"),o=_("../mx-monitor/index");i.applyStyle("_J","._fl{position:absolute;border:1px solid #e6e6e6;font-size:14px;max-height:260px;overflow:auto;list-style:none;border-radius:4px;background-color:#fff;display:none;z-index:10;padding:3px 0;line-height:1.8}._fm{padding:0 4px;cursor:pointer;margin:2px 0}._fn{color:#666;display:block;width:100%;padding:0 6px;height:29px;line-height:29px;border-radius:4px}._fo,._fn:active,._fn:focus,._fn:hover{color:#333;background-color:#f0f0f0}._fo{border-radius:4px;text-decoration:none;outline:0}"),t.exports=i.View.extend({tmpl:{html:'<ul mx-guid="g0" class="_fl _aj" style="width:<%=$$.width%>px" mx-mouseout="__eC()" mx-mousemove="__eD()" mx-contextmenu="__E()">1</ul>',subs:[{keys:["width","rList","list","viewId","textKey"],path:'ul[mx-guid="g0"]',tmpl:'<%if($$.rList){for(var a=0,b;a<$$.list.length;a++){b=$$.list[a]%><li class="_fm"><a href="#" class="_fn" data-idx="<%!a%>" mx-click="__eB({item:\'<%@b%>\'})" id="sg_<%!$$.viewId%>_<%!a%>"><%=$$.textKey?b[$$.textKey]:b%></a></li><%}}%>',s:"1",attr:'style="width:<%=$$.width%>px"',attrs:[{n:"style"}],mask:"21111"}]},init:function(_){var e=this;e.__fO=_.scrollTop||0,e.__er=_.list||[],e.__cS=0|(_.offsetLeft||0),o.__e(),e.on("destroy",function(){o.__g(e),o.__h(),e.__i.off("keyup paste input",e.__es).off("focus",e.__et)}),e.updater.set({viewId:e.id,width:_.width||340,textKey:_.textKey,valueKey:_.valueKey}),e.__fP=-1,e.__fQ=[e.id,"suggest_"+e.id],_.relateIds&&(e.__fQ=e.__fQ.concat(_.relateIds.split(",")))},__j:function(_){for(var e=this.__fQ,t=0;t<e.length;t++)if(i.inside(_,e[t]))return!0;return!1},__fS:function(_,e){var t=this;e||(t.__er=_),t.__fP=-1,t.updater.digest({list:t.__fR=_}),t.__cQ&&(_&&_.length?t.__cQ.addClass("_fl"):t.__cQ.removeClass("_fl"))},render:function(){var _=this,e=r("#"+_.id);_.__i=e,e.on("focus",_.__et=r.proxy(_.__f,_)).on("keyup paste input",_.__es=r.proxy(_.__ew,_));var t="suggest_"+_.id;r("<div />").attr("id",t).insertAfter(e),_.updater.to(t),_.__fS(_.__er),_.__cQ=r("#"+t+" ul"),_.__er&&_.__er.length||_.__cQ.removeClass("_fl"),setTimeout(_.wrapAsync(function(){_.__cQ.prop("scrollTop",_.__fO)}),0)},__ew:function(_){var e=this;e.__k||e.__f();var t=e.__fR;if(40==_.keyCode)e.__ex(),e.__fP++,e.__fP>=t.length&&(e.__fP=0),e.__ey();else if(38==_.keyCode)e.__ex(),e.__fP--,e.__fP<0&&(e.__fP=t.length-1),e.__ey();else if(13==_.keyCode){if(e.__fP>-1&&e.__fP<e.__fR.length){var i=e.__fR[e.__fP];e.__i.trigger({type:"pick",item:i}),e.__ex(),e.__fP=-1,e.__a()}}else{var o=r.trim(_.target.value);if(o!=e.__cq)if(e.__cq=o,o){for(var s=[],f=e.__er.slice(),a=e.updater.get("textKey"),n=0,l=void 0;n<f.length;n++)l=f[n],((a?l[a]:l)+"").indexOf(o)>=0&&s.push(l);e.__fS(s,!0)}else e.__fS(e.__er,!0)}},__f:function(){var _=this,e=_.updater;if(!_.__k){_.__k=!0,e.get("rList")||e.digest({rList:!0}),o.__l(_);var t=_.__i.position();_.__cQ.show().css({left:t.left+_.__cS,top:t.top+_.__i.outerHeight()+10}),_.__i.trigger("showlist")}},__ex:function(){var _=this;r("#sg_"+_.id+"_"+_.__fP).removeClass("_fo")},__ey:function(_){var e=this,t=r("#sg_"+e.id+"_"+e.__fP);if(t.addClass("_fo"),!_&&t.length){e.__eA=1;var i=t.outerHeight(),o=(e.__fP+1)*i,s=e.__cQ,f=s.height(),a=s.prop("scrollTop"),n=Math.ceil(f/i);o<a+i?s.prop("scrollTop",o-i):o>a+f&&s.prop("scrollTop",(e.__fP+2-n)*i)}},__a:function(){var _=this;_.__k&&(_.__k=!1,o.__g(_),_.__cQ.hide(),_.__i.trigger("hidelist"))},"__eB<click>":function(_){_.preventDefault();var e=this,t=_.params.item;e.__i.trigger({type:"pick",item:t,scrollTop:e.__cQ.prop("scrollTop")}),e.__a()},"__eC<mouseout>":function(_){if(!i.inside(_.relatedTarget,_.eventTarget)){var e=this;e.__ex(),e.__fP=-1}},"__eD<mousemove>":function(_){var e=this;if(e.__eA)delete e.__eA;else{var t=r(_.target);if(t.is("li")){var i=t.data("idx");i!=e.__fP&&(e.__ex(),e.__fP=i,e.__ey(!0))}}},"__E<contextmenu>":function(_){_.preventDefault()}})});