define("mx-calendar/range",["magix","$","./index"],(e,t,a)=>{let i=e("magix"),d=e("$"),s=e("./index"),n=s.parse,r=s.format;i.applyStyle("_h","._bl{border:1px solid #e6e6e6;padding:10px 0;border-radius:4px;background-color:#fff;width:265px}._bm{padding:0 10px}._bn{height:24px;line-height:24px;border-radius:4px;margin:0 10px 10px 0;width:70px;float:left;text-align:center;display:inline-block;cursor:pointer}._bn:hover{background:#e6e6e6}._bo,._bo:hover{color:#fff;background:#f96447}._bp{padding:0 10px;margin-bottom:15px}._bq{background-color:#f0f0f0;border:0;height:24px;width:117px;text-align:center;display:inline-block;color:#333;border-radius:4px;padding:6px 9px;cursor:text}._br{border-top:1px solid #e6e6e6;margin-left:10px;padding-top:10px;width:92%}._bs{width:330px}._bs ._bq{width:150px}");let _=(e,t)=>{t||(t=new Date);let a=new Date(t.getTime()+864e5*e);return a=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),new Date(a)},l=e=>((e=new Date(e)).setHours(23),e.setMinutes(59),e.setSeconds(59),e),p=_(0),o=_(-1),c=e=>{let t=_(-7),a=e-t.getDay();return{start:_(a,t),end:l(_(a+6,t))}},g=c(0),u=c(1),m=(()=>{let e=new Date(p.getFullYear(),p.getMonth()-1,1),t=e.getFullYear(),a=e.getMonth(),i=32-new Date(t,a,32).getDate();return{start:e,end:l(new Date(t,a,i))}})();m.text="上月",g.text="上周（周日至周六）",u.text="上周（周一至周日）";let h={today:{text:"今天",start:p,end:l(p)},yesterday:{text:"昨天",start:o,end:l(o)},preMonth:m,preWeekSun:g,preWeekMon:u,passedThisMonth:{text:"本月",start:_(1-p.getDate()),end:l(o)},lastestThisMonth:{text:"本月",start:_(1-p.getDate()),end:l(p)}},x=[2,6,13,14,29,89];for(let e,t,a=0;a<x.length;a++)h["passed"+(t=(e=x[a])+1)]={text:"过去"+t+"天",start:_(-t),end:l(o)},h["lastest"+t]={text:"最近"+t+"天",start:_(-e),end:l(p)};let k=["preMonth","preWeekMon","preWeekSun","passedThisMonth","lastestThisMonth"],b=i.View.extend({tmpl:{html:'<div mx-guid="g0" class="_bl<%if($$.showTime){%> _bs<%}%> _aj" mx-contextmenu="__D()">1</div>',subs:[{keys:["showTime","quickDates"],path:'div[mx-guid="g0"]',tmpl:'<%if($$.quickDates.length){%><div class="_bm"><div class="_n">快捷日期</div><div mx-guid="g1" class="_ai">2</div></div><%}%><div class="_bp"><div class="_n">日期范围</div><div class="_ai"><input mx-guid="g2" readonly="readonly" class="_bq" data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="__P({first:true})" id="start_<%=$$.id%>" mx-change="__O()">-<input mx-guid="g3" readonly="readonly" class="_bq" data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="__P()" id="end_<%=$$.id%>" mx-change="__O()"></div></div><div class="_br _ai"><button mx-click="__n()" type="button" class="_an _ao">确定</button><button mx-click="__Q()" type="button" class="_an _s">取消</button></div>',s:"1",attr:'class="_bl<%if($$.showTime){%> _bs<%}%> _aj"',attrs:[{n:"class",p:1,f:"className"}],mask:"21"},{keys:["quickDates","quickDatesMap","dates"],path:'div[mx-guid="g1"]',tmpl:'<%for(var _=0;_<$$.quickDates.length;_++){var a=$$.quickDates[_],b=$$.quickDatesMap[a]%><span class="_bn _al<%if($$.dates.quickDateKey==a){%> _bo<%}%>" mx-click="__n({quick:true,key:\'<%=$eq(a)%>\'})" title="<%=b?b.text:a%>"><%=b?b.text:a%></span><%}%>',s:"2"},{keys:["dates","id"],path:'input[mx-guid="g2"]',attr:'data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="__P({first:true})" id="start_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]},{keys:["dates","id"],path:'input[mx-guid="g3"]',attr:'data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="__P()" id="end_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]}]},init(e){let t=this;t.__E=e.min,t.__F=e.max,t.__G=e.dates,t.__H=e.quickDates||[],t.__I=e.placement,t.__J=e.align,t.__K=e.timeType,t.__L=e.dateType,t.__M=e.formatter},__i(e){let t=this,a=i.inside(e,t.id);if(!a){let d=t.owner.children();for(let t=d.length-1;t>=0;t--){let s=i.Vframe.get(d[t]);if(s&&(a=s.invoke("inside",e)),a)break}}return a},render(){let e=this;e.updater.digest({id:e.id,showTime:e.__K,quickDatesMap:h,quickDates:e.__H,dates:e.__G}),e.__h=d("#"+e.id)},__N(){this.updater.digest({dates:this.__G})},"__O<change>"(e){let t=this;e.stopPropagation(),d(e.eventTarget).data("hidden",e.date+(e.time?" "+e.time:""));let a=d("#start_"+t.id).data("hidden"),i=d("#end_"+t.id).data("hidden"),s=t.updater.get("dates"),r=n(a,s.formatter);n(i,s.formatter).getTime()<r.getTime()&&(i=a,d("#end_"+t.id).data("hidden",i)),s=b.getDescription(a,i,t.__H,t.__M),t.updater.digest({dates:s})},"__P<click>"(e){let t=this,a=e.eventTarget,i=e.params,s={max:t.__F,min:t.__E,timeType:t.__K,dateType:t.__L,selected:a.value,placement:t.__I,align:t.__J};i.first||(s.min=(e=>((e=new Date(e)).setHours(0),e.setMinutes(0),e.setSeconds(0),e))(d("#start_"+t.id).data("hidden"))),a.vframe?a.vframe.invoke("update",s):t.owner.mountVframe(a.id,"mx-calendar/datepicker",s).invoke("__e")},"__n<click>"(e){let t,a,i,s,n=this,_=e.params,l=n.updater,p=l.get("dates");if(_.quick){p.quickDateKey=_.key;let e=h[_.key];t=e.start,a=e.end,i=r(t,p.formatter),s=r(a,p.formatter),d("#start_"+n.id).data("hidden",i),d("#end_"+n.id).data("hidden",s),p.startStr=i,p.endStr=s,p.start=t,p.end=a,p.quickDateText=e.text,l.digest({dates:p})}else i=d("#start_"+n.id).data("hidden"),s=d("#end_"+n.id).data("hidden"),p=b.getDescription(i,s,n.__H,n.__M),l.digest({dates:p});n.__h.trigger({type:"change",dates:n.__G=p})},"__Q<click>"(){this.__h.trigger("cancel"),this.__N()},"__D<contextmenu>"(e){e.preventDefault()}},{getSupportQuickDates:()=>h,getDescription(e,t,a,d){e=n(e),t=n(t);let s,_={startStr:r(e,d),endStr:r(t,d),formatter:d},l=p.getTime(),c=o.getTime(),g=e.getTime(),u=t.getTime();if(g==u)l==u?s="today":c==u&&(s="yesterday");else{let e,t=(u-g)/864e5+1;c==u?(e=h[s="passed"+t])||(s=0):l==u&&((e=h[s="lastest"+t])||(s=0))}if(!s)for(let e=k.length-1;e>-1;e--){let t=k[e],a=h[t];if(u==a.end.getTime()&&g==a.start.getTime()){s=t;break}}return s&&a&&(i.toMap(a)[s]||(s=0)),s&&(_.quickDateText=h[s].text,_.quickDateKey=s),_}});a.exports=b});