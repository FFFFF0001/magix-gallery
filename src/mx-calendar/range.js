define("mx-calendar/range",["magix","$","./index"],function(t,e,a){var i=t("magix"),d=t("$"),n=t("./index"),r=n.parse,s=n.format;i.applyStyle("_h","._bm{border:1px solid #e6e6e6;padding:10px 0;border-radius:4px;background-color:#fff;width:265px}._bn{padding:0 10px}._bo{height:24px;line-height:24px;border-radius:4px;margin:0 10px 10px 0;width:70px;float:left;text-align:center;display:inline-block;cursor:pointer}._bo:hover{background:#e6e6e6}._bp,._bp:hover{color:#fff;background:#6363e6}._bq{padding:0 10px;margin-bottom:15px}._br{background-color:#f0f0f0;border:0;height:24px;width:117px;text-align:center;display:inline-block;color:#333;border-radius:4px;padding:6px 9px;cursor:text}._bs{border-top:1px solid #e6e6e6;margin-left:10px;padding-top:10px;width:92%}._bt{width:330px}._bt ._br{width:150px}");var _=function(t,e){e||(e=new Date);var a=new Date(e.getTime()+864e5*t);return a=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),new Date(a)},o=function(t){return(t=new Date(t)).setHours(23),t.setMinutes(59),t.setSeconds(59),t},c=function(t){return(t=new Date(t)).setHours(0),t.setMinutes(0),t.setSeconds(0),t},u=_(0),p=_(-1),l=function(t){var e=_(-7),a=t-e.getDay();return{start:_(a,e),end:o(_(a+6,e))}},g=l(0),m=l(1),x=function(){var t=new Date(u.getFullYear(),u.getMonth()-1,1),e=t.getFullYear(),a=t.getMonth(),i=32-new Date(e,a,32).getDate();return{start:t,end:o(new Date(e,a,i))}}();x.text="上月",g.text="上周（周日至周六）",m.text="上周（周一至周日）";for(var h={today:{text:"今天",start:u,end:o(u)},yesterday:{text:"昨天",start:p,end:o(p)},preMonth:x,preWeekSun:g,preWeekMon:m,passedThisMonth:{text:"本月",start:_(1-u.getDate()),end:o(p)},lastestThisMonth:{text:"本月",start:_(1-u.getDate()),end:o(u)}},v=[2,6,13,14,29,89],f=0,k=void 0,b=void 0;f<v.length;f++)h["passed"+(b=(k=v[f])+1)]={text:"过去"+b+"天",start:_(-b),end:o(p)},h["lastest"+b]={text:"最近"+b+"天",start:_(-k),end:o(u)};var $=["preMonth","preWeekMon","preWeekSun","passedThisMonth","lastestThisMonth"],D=i.View.extend({tmpl:{html:'<div mx-guid="g0" class="_bm<%if($$.showTime){%> _bt<%}%> _aj" mx-contextmenu="__E()">1</div>',subs:[{keys:["showTime","quickDates"],path:'div[mx-guid="g0"]',tmpl:'<%if($$.quickDates.length){%><div class="_bn"><div class="_n">快捷日期</div><div mx-guid="g1" class="_ai">2</div></div><%}%><div class="_bq"><div class="_n">日期范围</div><div class="_ai"><input mx-guid="g2" readonly="readonly" class="_br" data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="__Q({first:true})" id="start_<%=$$.id%>" mx-change="__P()">-<input mx-guid="g3" readonly="readonly" class="_br" data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="__Q()" id="end_<%=$$.id%>" mx-change="__P()"></div></div><div class="_bs _ai"><button mx-click="__o()" type="button" class="_an _ao">确定</button><button mx-click="__R()" type="button" class="_an _s">取消</button></div>',s:"1",attr:'class="_bm<%if($$.showTime){%> _bt<%}%> _aj"',attrs:[{n:"class",p:1,f:"className"}],mask:"21"},{keys:["quickDates","quickDatesMap","dates"],path:'div[mx-guid="g1"]',tmpl:'<%for(var a=0;a<$$.quickDates.length;a++){var b=$$.quickDates[a],c=$$.quickDatesMap[b]%><span class="_bo _al<%if($$.dates.quickDateKey==b){%> _bp<%}%>" mx-click="__o({quick:true,key:\'<%=$eq(b)%>\'})" title="<%=c?c.text:b%>"><%=c?c.text:b%></span><%}%>',s:"2"},{keys:["dates","id"],path:'input[mx-guid="g2"]',attr:'data-hidden="<%=$$.dates.startStr%>" value="<%=$$.dates.startStr%>" mx-click="__Q({first:true})" id="start_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]},{keys:["dates","id"],path:'input[mx-guid="g3"]',attr:'data-hidden="<%=$$.dates.endStr%>" value="<%=$$.dates.endStr%>" mx-click="__Q()" id="end_<%=$$.id%>"',attrs:[{n:"data-hidden"},{n:"value",q:1,p:1},{n:"mx-click"},{n:"id",p:1}]}]},init:function(t){var e=this;e.__F=t.min,e.__G=t.max,e.__H=t.dates,e.__I=t.quickDates||[],e.__J=t.placement,e.__K=t.align,e.__L=t.timeType,e.__M=t.dateType,e.__N=t.formatter},__j:function(t){var e=this,a=i.inside(t,e.id);if(!a)for(var d=e.owner.children(),n=d.length-1;n>=0;n--){var r=i.Vframe.get(d[n]);if(r&&(a=r.invoke("inside",t)),a)break}return a},render:function(){var t=this;t.updater.digest({id:t.id,showTime:t.__L,quickDatesMap:h,quickDates:t.__I,dates:t.__H}),t.__i=d("#"+t.id)},__O:function(){var t=this;t.updater.digest({dates:t.__H})},"__P<change>":function(t){var e=this;t.stopPropagation(),d(t.eventTarget).data("hidden",t.date+(t.time?" "+t.time:""));var a=d("#start_"+e.id).data("hidden"),i=d("#end_"+e.id).data("hidden"),n=e.updater.get("dates"),s=r(a,n.formatter);r(i,n.formatter).getTime()<s.getTime()&&(i=a,d("#end_"+e.id).data("hidden",i)),n=D.getDescription(a,i,e.__I,e.__N),e.updater.digest({dates:n})},"__Q<click>":function(t){var e=this,a=t.eventTarget,i=t.params,n={max:e.__G,min:e.__F,timeType:e.__L,dateType:e.__M,selected:a.value,placement:e.__J,align:e.__K};i.first||(n.min=c(d("#start_"+e.id).data("hidden"))),a.vframe?a.vframe.invoke("update",n):e.owner.mountVframe(a.id,"mx-calendar/datepicker",n).invoke("__f")},"__o<click>":function(t){var e,a,i,n,r=this,_=t.params,o=r.updater,c=o.get("dates");if(_.quick){c.quickDateKey=_.key;var u=h[_.key];e=u.start,a=u.end,i=s(e,c.formatter),n=s(a,c.formatter),d("#start_"+r.id).data("hidden",i),d("#end_"+r.id).data("hidden",n),c.startStr=i,c.endStr=n,c.start=e,c.end=a,c.quickDateText=u.text,o.digest({dates:c})}else i=d("#start_"+r.id).data("hidden"),n=d("#end_"+r.id).data("hidden"),c=D.getDescription(i,n,r.__I,r.__N),o.digest({dates:c});r.__i.trigger({type:"change",dates:r.__H=c})},"__R<click>":function(){var t=this;t.__i.trigger("cancel"),t.__O()},"__E<contextmenu>":function(t){t.preventDefault()}},{getSupportQuickDates:function(){return h},getDescription:function(t,e,a,d){t=r(t),e=r(e);var n,_={startStr:s(t,d),endStr:s(e,d),formatter:d},o=u.getTime(),c=p.getTime(),l=t.getTime(),g=e.getTime();if(l==g)o==g?n="today":c==g&&(n="yesterday");else{var m=(g-l)/864e5+1;c==g?h[n="passed"+m]||(n=0):o==g&&(h[n="lastest"+m]||(n=0))}if(!n)for(var x=$.length-1;x>-1;x--){var v=$[x],f=h[v];if(g==f.end.getTime()&&l==f.start.getTime()){n=v;break}}return n&&a&&(i.toMap(a)[n]||(n=0)),n&&(_.quickDateText=h[n].text,_.quickDateKey=n),_}});a.exports=D});