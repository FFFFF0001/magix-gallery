define("mx-calendar/index",["magix","$","mx-time/index"],(e,t,a)=>{e("mx-time/index");let s=e("magix");s.applyStyle("_g","._aS{background-color:#fff;display:inline-block;border:1px solid #e6e6e6;padding:0;border-radius:4px;overflow-y:hidden;z-index:10;color:#333;text-align:center;position:relative}._aT{color:#777}._aU{height:32px;line-height:32px;padding:1px}._aV,._aW{color:#ccc;display:inline-block;padding:6px 7px;line-height:100%;vertical-align:top;cursor:pointer}._aV:focus,._aV:hover,._aW:focus,._aW:hover{color:#f96447}._aX{display:inline-block;cursor:pointer;padding:5px 10px;border-radius:4px;line-height:1}._aX:hover{background-color:#eee}._aY{width:245px}._aZ{color:#333;background-color:#fafafa;padding:0 10px}._b_{padding:10px}._ba,._bb{padding:1px 0;position:absolute;top:-100%;left:0;right:0;-webkit-transition:top .15s;transition:top .15s;background-color:#fff}._bc{top:0}._bd{height:59px;margin:2px;float:left;width:77px;cursor:pointer;line-height:59px;border-radius:4px;font-size:16px}._be:hover,._bd:hover{background:#f0f0f0}._be,._bf{width:28px;height:28px;line-height:28px;margin:3px 2px;float:left;border-radius:4px;cursor:pointer}._bg,._bg:hover{color:#fff;background-color:#f96447}._bh,._bh:hover{color:#eee;cursor:not-allowed;background:#fff}._bi{padding:5px}._bj,._bi{border-top:1px solid #e6e6e6}._bj{margin:10px;padding:10px 0 0;text-align:left}._bk{-webkit-transform:scaleX(-1);transform:scaleX(-1)}");let i=e("$"),_=(e,t)=>32-new Date(e,t-1,32).getDate(),l=["日","一","二","三","四","五","六"],d=e=>("0"+e).slice(-2),r=(e,t,a)=>{let s,i=e.getTime();return t&&(s=i<t.getTime()),s||(s=!!a&&i>a.getTime()),s},n=(e,t,a,s)=>{let i,_=parseInt(e+d(t),10);return a&&(i=_<(a=parseInt(a.getFullYear()+d(a.getMonth()),10))),!i&&s&&(i=_>(s=parseInt(s.getFullYear()+d(s.getMonth()),10))),i},p=(e,t,a)=>{let s;return t&&(s=e<t.getFullYear()),!s&&a&&(s=e>a.getFullYear()),s},g={y:{reg:/y+/gi,fn:(e,t)=>String(t.getFullYear()).slice(-e.length)},M:{reg:/M+/g,fn:(e,t,a)=>(a=t.getMonth()+1,d(a).slice(-e.length))},d:{reg:/d+/gi,fn:(e,t,a)=>(a=t.getDate(),d(a).slice(-e.length))},h:{reg:/h+/gi,fn:(e,t,a)=>(a=t.getHours(),d(a).slice(-e.length))},m:{reg:/m+/g,fn:(e,t,a)=>(a=t.getMinutes(),d(a).slice(-e.length))},s:{reg:/s+/g,fn:(e,t,a)=>(a=t.getSeconds(),d(a).slice(-e.length))},S:{reg:/S+/g,fn:(e,t,a)=>(a=t.getMilliseconds(),String(a).substring(0,e.length))}},o=e=>e instanceof Date?e:(e=new Date(Date.parse(String(e).replace(/-/g,"/"))))instanceof Date&&"Invalid Date"!=e&&!isNaN(e)?e:null,c=(e,t)=>{e=o(e),t=t||"YYYY-MM-dd";let a,s=t=>g[a].fn(t,e);for(a in g)t=t.replace(g[a].reg,s);return t};a.exports=s.View.extend({tmpl:{html:'<div mx-guid="g0" class="_aS _aj" mx-contextmenu="__D()">1</div>',subs:[{keys:["types"],path:'div[mx-guid="g0"]',tmpl:'<%if($$.types.day){%><div mx-guid="g1" id="days_<%=$$.id%>" class="_ai">2</div><%}if($$.types.month){%><div id="months_<%=$$.id%>" class="_ai<%if($$.types.day){%> _ba<%}%>"><div class="_aU"><span class="__ _aV _aa" mx-click="__w()">&#xe61e;</span><h4 mx-guid="g7" mx-click="__y()" class="_aX">8</h4><span class="__ _aW _ab _bk" mx-click="__w({next:true})">&#xe61e;</span></div><div mx-guid="g8" class="_aY _ai">9</div></div><%}if($$.types.year){%><div id="years_<%=$$.id%>" class="_ai<%if($$.types.day||$$.types.month){%> _bb<%}%>"><div class="_aU"><span class="__ _aV _aa" mx-click="__w({range:true})">&#xe61e;</span><h4 mx-guid="ga" class="_aX">11</h4><span class="__ _aW _ab _bk" mx-click="__w({range:true,next:true})">&#xe61e;</span></div><div mx-guid="gb" class="_aY _ai">12</div></div><%}%>',s:"1"},{keys:["timeType","hasBtn"],path:'div[mx-guid="g1"]',pKeys:["types"],tmpl:'<div class="_aU"><span class="__ _aV _aa" mx-click="__v()">&#xe61e;</span><h4 mx-guid="g2" mx-click="<%if($$.types.month){%>__x<%}else{%>__y<%}%>()" class="_aX">3</h4><span class="__ _aW _bk _ab" mx-click="__v({next:true})">&#xe61e;</span></div><div class="_aY"><div mx-guid="g3" class="_aZ _ai">4</div><div mx-guid="g4" class="_b_ _ai">5</div></div><%if($$.timeType){%><div mx-guid="g5" class="_ai _bi" mx-change="__C()" mx-view="mx-time/index?time=<%!$eu($$.timeValue)%>&type=<%!$eu($$.timeType)%>"></div><%if($$.hasBtn){%><div class="_bj"><button type="button" class="_an _ao" mx-click="__a({enter:true})">确定</button><button type="button" class="_an _s" mx-click="__a()">取消</button></div><%}}%>',s:"2"},{keys:["types","year","month"],path:'h4[mx-guid="g2"]',tmpl:"<%=$$.year%>-<%=('0'+$$.month).slice(-2)%>",s:"3",attr:'mx-click="<%if($$.types.month){%>__x<%}else{%>__y<%}%>()"',attrs:[{n:"mx-click"}],mask:"211"},{keys:["weekText"],path:'div[mx-guid="g3"]',tmpl:'<%for(var _=0;_<$$.weekText.length;_++){%><span class="_bf"><%=$$.weekText[_]%></span><%}%>',s:"4"},{keys:["days"],path:'div[mx-guid="g4"]',tmpl:'<%for(var a=0;a<$$.days.length;a++){var b=$$.days[a];for(var c=0;c<b.length;c++){%><span class="_be<%if(b[c].otherMonth){%> _aT<%}if(b[c].disabled){%> _bh<%}if(b[c].selected){%> _bg<%}%>" <%if(!b[c].disabled){%> mx-click="__B({toMonth:<%=b[c].month%>,date:\'<%=$eq(b[c].full)%>\'})" <%}%> title="<%=b[c].full%>"><%=b[c].day%></span><%}}%>',s:"5"},{keys:["timeValue"],path:'div[mx-guid="g5"]',pKeys:["types","timeType","hasBtn"],attr:'mx-view="mx-time/index?time=<%!$eu($$.timeValue)%>&type=<%!$eu($$.timeType)%>"',attrs:[{n:"mx-view",v:1}]},{keys:["year"],path:'h4[mx-guid="g7"]',tmpl:"<%=$$.year%>",s:"8"},{keys:["months"],path:'div[mx-guid="g8"]',pKeys:["types"],tmpl:'<%for(var d=0,e;d<$$.months.length;d++){e=$$.months[d]%><span class="_bd<%if(e.disabled){%> _bh<%}if(e.selected){%> _bg<%}%>" <%if(!e.disabled){%> mx-click="__A({month:\'<%=$eq(e.month)%>\'})" <%}%>><%=e.month%></span><%}%>',s:"9"},{keys:["startYear","endYear"],path:'h4[mx-guid="ga"]',tmpl:"<%=$$.startYear%>-<%=$$.endYear%>",s:"11"},{keys:["years"],path:'div[mx-guid="gb"]',pKeys:["types"],tmpl:'<%for(var f=0,g;f<$$.years.length;f++){g=$$.years[f]%><span class="_bd<%if(g.selected){%> _bg<%}if(g.disabled){%> _bh<%}if(!f||f==$$.years.length-1){%> _aT<%}%>" <%if(!g.disabled){%> mx-click="__z({year:\'<%=$eq(g.year)%>\'})" <%}%>><%=g.year%></span><%}%>',s:"12"}]},init(e){this.__c=e},render(){this.update(this.__c)},__m(){let e=this;i("#years_"+e.id).removeClass("_bc"),i("#months_"+e.id).removeClass("_bc");let t=e.updater;if(t.get().timeType){let a=!1;e.__o&&(e.__p(e.__o),e.__q(),e.__r(),e.__s(),a=!0,delete e.__o),e.__t&&(t.set({timeValue:e.__t}),a=!0,delete e.__t),a&&t.digest()}},update(e){(e=e||{}).selected||(e.selected=new Date);let t=(e=>{e||(e="all");let t={year:!0,month:!0,day:!0};if("all"!=e)for(let a in t)-1===e.indexOf(a)&&delete t[a];return t})(e.dateType),a=0|e.weekStart,s=o(e.selected),i=this,_=i.updater,d=o(e.max),r=o(e.min),n=e.timeType,p=c(s,"hh:mm:ss");_.set({types:t,timeType:n,timeValue:p,hasBtn:e.hasBtn,dateValue:c(s,e.formatter),max:d,min:r,id:i.id,weekStart:a,weekText:(e=>{let t=[];for(let a=0;a<7;a++)t[a]=l[(a+e)%7];return t})(a)}),i.__p(s),i.__q(),i.__r(),i.__s(!0)},__p(e){let t=this.updater;(e=o(e))&&t.set({year:e.getFullYear(),month:e.getMonth()+1,selectedYear:e.getFullYear(),selectedMonth:e.getMonth()+1,selected:c(e)})},__q(e){let t=this.updater,a=t.get(),s=a.year,i=a.min,_=a.max,l=s-s%10-1,d=l+11,r=[];for(let e=l;e<=d;e++)r.push({year:e,selected:e==a.selectedYear,disabled:p(e,i,_)});t.set({startYear:l,endYear:d,years:r}),e&&t.digest()},__r(e){let t=[],a=this.updater,s=a.get(),i=s.year,_=s.min,l=s.max;for(let e=1;e<=12;e++)t.push({month:e,selected:i==s.selectedYear&&e==s.selectedMonth,disabled:n(i,e-1,_,l)});a.set({months:t}),e&&a.digest()},__s(e){let t,a,s,i,l=[],d=this.updater,n=d.get("weekStart"),p=d.get("year"),g=d.get("month"),o=(7-n+new Date(p,g-1,1).getDay())%7,h=[],m=_(p,g),u=_(p,g-1),x=d.get("max"),y=d.get("min"),b=d.get("selected");for(t=1;t<=o;t++)a=u-(o-t),s=new Date(p,g-2,a),h.push({month:g-1,full:c(s),day:a,otherMonth:!0,disabled:r(s,y,x)});for(t=1;t<=m;t++)s=new Date(p,g-1,t),i=c(s),h.push({selected:i==b,day:t,month:g,full:i,disabled:r(s,y,x)}),(t+o)%7==0&&(l.push(h),h=[]);let f=h.length;for(t=f;t<14&&(a=t-f+1,s=new Date(p,g,a),h.push({month:g+1,day:a,otherMonth:!0,full:c(s),disabled:r(s,y,x)}),(t+1)%7!=0||(l.push(h),h=[],6!=l.length));t++);d.set({days:l}),e&&d.digest()},__u(e){let t=this,a=t.updater.get();a.types.day?a.timeType&&a.hasBtn?e&&i("#"+t.id).trigger({type:"change",date:a.dateValue,time:a.timeType?a.timeValue:null}):i("#"+t.id).trigger({type:"change",date:a.dateValue,time:a.timeType?a.timeValue:null}):i("#"+t.id).trigger({type:"change",date:a.selectedYear+(a.types.month?"-"+("0"+a.selectedMonth).slice(-2):"")})},"__v<click>"(e){let t=this.updater,a=t.get("month"),s=t.get("year");e.params.next?(a+=1)>12&&(a=1,s++):(a-=1)<1&&(a=12,s--),t.set({year:s,month:a}),this.__s(!0)},"__w<click>"(e){let t=this,a=e.params,s=t.updater,i=s.get("year");a.range?i+=a.next?10:-10:i+=a.next?1:-1,s.set({year:i}),a.range?t.__q(!0):t.__r(!0)},"__x<click>"(){i("#months_"+this.id).addClass("_bc"),this.__r(!0)},"__y<click>"(){i("#years_"+this.id).addClass("_bc"),this.__q(!0)},"__z<click>"(e){let t=e.params.year,a=this,s=a.updater.get().types;s.day||s.month?(a.updater.set({year:+t}),i("#years_"+a.id).removeClass("_bc"),s.month?a.__r(!0):a.__s(!0)):(a.__p(t+"-01-01"),a.__q(!0),a.__u())},"__A<click>"(e){let t=e.params.month,a=this,s=a.updater,_=s.get();_.types.day?(s.set({month:+t}),i("#months_"+a.id).removeClass("_bc"),a.__s(!0)):(a.__p(_.year+"-"+t+"-01"),a.__r(!0),a.__u())},"__B<click>"(e){let t=this;i("#days_"+t.id+" span").removeClass("_bg"),i(e.eventTarget).addClass("_bg");let a=t.updater,s=a.get("month"),_=e.params.toMonth!=s;t.__p(e.params.date),_&&(t.__q(),t.__r(),t.__s(!0)),t.__o||(t.__o=a.get("dateValue")),a.set({dateValue:e.params.date}),t.__u()},"__C<change>"(e){e.stopPropagation();let t=this;t.__t||(t.__t=t.updater.get("timeValue")),t.updater.set({timeValue:e.time}),t.__u()},"__a<click>"(e){let t=this;if(e.params.enter)return delete t.__o,delete t.__t,void t.__u(!0);i("#"+t.id).trigger("cancel")},"__D<contextmenu>"(e){e.preventDefault()}},{parse:o,format:c,dateDisabled:r})});