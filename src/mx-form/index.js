define("mx-form/index",["$","magix"],(e,t,r)=>{let i=e("$"),l=e("magix");l.applyStyle("_r","._dh,._dh:hover{border-color:#a62a22!important}._di{display:none;position:absolute;white-space:nowrap;word-wrap:normal;pointer-events:none;color:#666;font-size:10px;top:1px;line-height:1}");let a=e=>e.replace(/[^\x00-\xff]/g,"xl").length,s={required:(e,t)=>!t||i.trim(e),number:(e,t)=>!(e=i.trim(e))||!t||e.indexOf(".")==e.lastIndexOf(".")&&/^-?[\d\.]+$/.test(e),length:(e,t)=>!(e.length<t[0]||e.length>t[1]),blength(e,t){let r=a(e);return!(r<t[0]||r>t[1])},minLength:(e,t)=>!((e=i.trim(e))&&e.length<t),maxLength:(e,t)=>!((e=i.trim(e))&&e.length>t),range:(e,t)=>(e=parseFloat(e),!isNaN(e)&&!(e<t[0]||e>t[1])),equalto:(e,t)=>i(t).val()==e,pattern(e,t){if(e=i.trim(e)){return new RegExp(t).test(e)}return!0},max:(e,t)=>!(+e>+t),min:(e,t)=>!(+e<+t)},n={required:()=>"必填",number:()=>"数字",length:(e,t)=>e[0]+"-"+e[1]+"个字之间,当前:"+t.length,blength:(e,t)=>e[0]+"-"+e[1]+"个字符之间,当前:"+a(t),range:e=>e[0]+"-"+e[1]+"之间的数字",equalto:e=>"与"+e+"同样的内容",pattern:()=>"格式有误",minLength:e=>"最小长度:"+e,maxLength:e=>"最大长度:"+e,max:e=>"不能大于 "+e,min:e=>"不能小于 "+e},o=(e,t)=>{let r,i,a=!0;for(let n in e)if(l.has(e,n)){let l=s[n];if(l&&!(a=l(t,i=e[n]))){r=n;break}}return{f:a,v:i,a:t,r:r}},d=(e,t,r,a)=>{let s=i('[mx-ssid="'+e+'"]');if(s.length)return s.addClass("_dh"),s.each((e,s)=>{let o=(s=i(s)).attr("id");o||(o=l.guid(),s.attr("id",o));let d=o+"_msg",h=i("#"+d);if(!h.length){let e=s.parent();"static"==e.css("position")&&e.addClass("_ag"),s.after('<div class="_di" id="'+d+'"/>'),h=i("#"+d)}h.html(n[t](r,a)).show();let p=s.outerWidth()-3,f=h.width(),m=s.position();h.css({top:m.top+2,left:m.left+p-f})}),!0},h=e=>{let t=i('[mx-ssid="'+e+'"]');t.removeClass("_dh"),t.each((e,t)=>{let r=(t=i(t)).attr("id")+"_msg";i("#"+r).hide()})},p=(e,t)=>{let r=e.params;if(r.m){let i=t[r.m+""+e.type];i&&(e.params=r.a,i.call(t,e))}};r.exports={fromKeys(e,t){t=(t+"").split(",");let r={};for(let i,a=0;a<t.length;a++)r[i=t[a]]=l.has(e,i)?e[i]:"";return r},isValid(e){let t=!0,r=this.owner.children(),a=!1;e||(e=[],a=!0);for(let i=0;i<r.length;i++){!1===l.Vframe.get(r[i]).invoke("isValid",[e])&&(t=!1)}i("#"+this.id+' [mx-ssid^="'+this.id+'"]').each((e,t)=>{i(t).trigger({type:"change",from:"faker"})});let s=this.updater.$form;if(s){let r=l.keys(s);r.length&&(e.push(r[0]),t=!1)}if(a){let t,r=1e20;for(let l,a,s=e.length;s--;)(l=i('[mx-ssid="'+e[s]+'"]')).length&&(a=l.offset()).top<r&&(t=l[0],r=a.top);t&&(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView&&t.scrollIntoView())}return t},triggerParent(e){i("#"+this.id).trigger({type:"change",from:"subview",values:e})},"__b<focusin>"(e){e.stopPropagation();let t=i(e.eventTarget);h(t.attr("mx-ssid")),p(e,this)},"__b<focusout>"(e){e.stopPropagation();i(e.eventTarget).trigger({type:"change",from:"faker"}),p(e,this)},"__b<change>"(e){let t=this,r=i(e.eventTarget),l=r.prop("_lt"),a=Date.now();if(l&&a-l<10)return;if(r.prop("_lt",a),e.viewId&&e.viewId!=t.id)return;e.viewId=t.id;let s="faker"==e.from||"subview"==e.from;e.stopPropagation();let n=e.params,f=t.updater;f.$form||(f.$form={});let m=f.$form,g=f.$keys||f.$k,c=n.c?n.c.slice():[n],u=!1,x=!0;i("#"+t.id).removeAttr("mx-ssid");let v=!1,_=(e,t,r)=>{i('input[name="'+e+'"]:checked').each(function(e,i){let l=i.value;r.number&&(l=parseFloat(l)),-1===t.indexOf(l)&&t.push(l)})};for(;c.length;){let t,l,a,s=c.shift(),n=s.p.split("."),p=s.f||{},w=n.pop(),b=f.get();for(;b&&n.length;)t=n.shift(),a||(a=t),b=b[t];if(a=a||w,"subview"==e.from)l=e.values[p.from||w];else if("checkbox"==r.prop("type")){let e=b[w],t=r.prop("checked");if(!0===e||!1===e)l=t;else if(l=r.val(),p.number&&(l=parseFloat(l)),i.isArray(e)){let i=r.prop("name");if(i)_(i,e=[],p);else{l=r.val(),p.number&&(l=parseFloat(l));let i=e.indexOf(l);t?-1===i&&e.push(l):i>-1&&e.splice(i,1)}l=e}else i.isPlainObject(e)?(t?e[l]=l:delete e[l],l=e):l=t?l:""}else l=r.val(),p.number&&(l=parseFloat(l));if(b&&b[w]!==l&&(b[w]=l,p.refresh&&(u=!0),!u&&p.silent||(g[a]=1),v=!0),x){let e=o(p,l),t=r.attr("mx-ssid");e.f?(delete m[t],h(t)):(m[t]=e,x=!1,d(t,e.r,e.v,e.a))}}x&&u&&f.digest(),v&&t.triggerParent(f.get()),s||p(e,t)},"$doc<htmlchanged>"(e){let t=this,r=t.updater.$form;e.vId==t.id&&(clearTimeout(t.__cr),t.__cr=setTimeout(t.wrapAsync(()=>{if(r)for(let e in r){let t=r[e];d(e,t.r,t.v,t.a)||delete r[e]}}),0))}}});