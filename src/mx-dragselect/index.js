define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],function(a,_,e){var t=a("magix"),i=a("../mx-dragdrop/index"),n=a("../mx-runner/index"),h=a("$");t.applyStyle("_m","._cc{left:-1000px;top:0;background:#d45414;position:absolute;opacity:.3;border:1px solid #7c2c0a}");var d=t.guid("area_"),r=h(window),o=h(document),c={__aI:function(){var a=h("#"+d);a.length||(a=h('<div id="'+d+'" class="_cc" />').appendTo("body"))},__aJ:function(a,_,e,t){h("#"+d).css({left:a,top:_,width:e,height:t})},__az:function(){h("#"+d).css({left:-1e5})}},g=function(a,_){var e=a.width/2,t=a.height/2,i=_.width/2,n=_.height/2,h={x:a.x+e,y:a.y+t},d={x:_.x+i,y:_.y+n};return Math.abs(d.x-h.x)<=e+i&&Math.abs(d.y-h.y)<=t+n};e.exports=t.View.extend({init:function(a){var _=this,e=h("#"+_.id);e.on("mousedown",function(a){a.preventDefault(),_.__aK(a)}),e.on("click",function(a){if(!_.__aL){var t=_.__aM(a.target);t&&e.trigger({type:"change",action:"add",mode:"click",node:t})}delete _.__aL}),_.on("destroy",function(){e.off("mousedown click")}),_.__aN=a.selector,_.__h=e},__aM:function(a){for(var _=this,e=null,t=_.__h[0];t!=a;){if(a.parentNode==t){e=a;break}a=a.parentNode}return e&&_.__aN&&(h.find.matchesSelector(e,_.__aN)||(e=null)),e},__aO:function(){for(var a=this,_=[],e=0,t=0,i=a.__aN?a.__h.find(a.__aN):a.__h.children();t<i.length;t++){var n=i[t],d=h(n),r=d.offset();_.push({id:e++,c:n,x:r.left,y:r.top,width:d.width(),height:d.height()})}return _},__aT:function(a){var _=this,e={x:a.pageX,y:a.pageY},t=_.__aP;e.x<t.x?e.x=t.x:e.x>t.x+t.width&&(e.x=t.x+t.width),e.y<t.y?e.y=t.y:e.y>t.y+t.height&&(e.y=t.y+t.height);var i=_.__aQ,n=Math.min(e.x,i.x),h=Math.min(e.y,i.y),d=Math.abs(e.x-i.x),r=Math.abs(e.y-i.y);c.__aJ(n,h,d,r);for(var o=_.__aR,f={x:n,y:h,width:d,height:r},x=_.__aS,l=0,s=o;l<s.length;l++){var p=s[l];g(f,p)?1!==x[p.id]&&(x[p.id]=1,_.__h.trigger({type:"change",action:"add",mode:"drag",node:p.c})):1===x[p.id]&&(delete x[p.id],_.__h.trigger({type:"change",action:"remove",mode:"drag",node:p.c}))}},__aK:function(a){if(1===a.which){var _=this;_.__aQ={x:a.pageX,y:a.pageY};var e=_.__h,t=e.offset();_.__aP={x:t.left,y:t.top,width:e.width(),height:e.height()},_.__aS={},c.__aI(),e.trigger("dragbegin"),i.begin(a.target,function(a){_.__aU(a)},function(a){_.__aV(a)})}},__aU:function(a){var _=this;if(!_.__aL){var e=_.__aQ;(Math.abs(a.pageX-e.x)>5||Math.abs(a.pageY-e.y)>5)&&(_.__aL=!0)}_.__aL&&(_.__aR||(_.__aR=_.__aO()),_.__aW=a,_.__aX(),_.__aT(a))},__aV:function(){var a=this;a.__aY(),c.__az(),delete a.__aW,delete a.__aQ,delete a.__aP,delete a.__aR,delete a.__aS,a.__h.trigger("dragfinish")},__aX:function(){var a=this;a.__aZ||(a.__aZ=function(){var _=0,e=0,t=a.__aW,i=r.scrollTop(),n=r.height(),h=o.height(),d=o.width(),c=r.width(),g=r.scrollLeft();t.pageX-g<20&&g>0?_=-Math.min(7,g):g+c-t.pageX<20&&g+c<d&&(_=Math.min(7,d-c-g)),t.pageY-i<20&&i>0?e=-Math.min(7,i):i+n-t.pageY<20&&i+n<h&&(e=Math.min(7,h-n-i)),(_||e)&&(t.pageX+=_,t.pageY+=e,a.__aT(t),window.scrollBy(_,e))},n.__b_(30,a.__aZ))},__aY:function(){var a=this;a.__aZ&&(n.__ba(a.__aZ),delete a.__aZ)}})});