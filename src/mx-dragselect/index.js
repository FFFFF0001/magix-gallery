define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],function(a,_,e){var t=a("magix"),i=a("../mx-dragdrop/index"),n=a("../mx-runner/index"),h=a("$");t.applyStyle("l",".bW{left:-1000px;top:0;background:#6363e6;position:absolute;opacity:.3;border:1px solid #2b2bb9}");var r=t.guid("area_"),d=h(window),o=h(document),g={__aG:function(){var a=h("#"+r);a.length||(a=h('<div id="'+r+'" class="bW" />').appendTo("body"))},__aH:function(a,_,e,t){h("#"+r).css({left:a,top:_,width:e,height:t})},__ax:function(){h("#"+r).css({left:-1e5})}},c=function(a,_){var e=a.width/2,t=a.height/2,i=_.width/2,n=_.height/2,h={x:a.x+e,y:a.y+t},r={x:_.x+i,y:_.y+n};return Math.abs(r.x-h.x)<=e+i&&Math.abs(r.y-h.y)<=t+n};e.exports=t.View.extend({init:function(a){var _=this,e=h("#"+_.id);e.on("mousedown",function(a){a.preventDefault(),_.__aI(a)}),e.on("click",function(a){if(!_.__aJ){var t=_.__aK(a.target);t&&e.trigger({type:"change",action:"add",mode:"click",node:t})}delete _.__aJ}),_.on("destroy",function(){e.off("mousedown click")}),_.__aL=a.selector,_.__h=e},__aK:function(a){for(var _=this,e=null,t=_.__h[0];t!=a;){if(a.parentNode==t){e=a;break}a=a.parentNode}return e&&_.__aL&&(h.find.matchesSelector(e,_.__aL)||(e=null)),e},__aM:function(){for(var a=this,_=[],e=0,t=0,i=a.__aL?a.__h.find(a.__aL):a.__h.children();t<i.length;t++){var n=i[t],r=h(n),d=r.offset();_.push({id:e++,c:n,x:d.left,y:d.top,width:r.width(),height:r.height()})}return _},__aR:function(a){var _=this,e={x:a.pageX,y:a.pageY},t=_.__aN;e.x<t.x?e.x=t.x:e.x>t.x+t.width&&(e.x=t.x+t.width),e.y<t.y?e.y=t.y:e.y>t.y+t.height&&(e.y=t.y+t.height);var i=_.__aO,n=Math.min(e.x,i.x),h=Math.min(e.y,i.y),r=Math.abs(e.x-i.x),d=Math.abs(e.y-i.y);g.__aH(n,h,r,d);for(var o=_.__aP,f={x:n,y:h,width:r,height:d},x=_.__aQ,l=0,s=o;l<s.length;l++){var p=s[l];c(f,p)?1!==x[p.id]&&(x[p.id]=1,_.__h.trigger({type:"change",action:"add",mode:"drag",node:p.c})):1===x[p.id]&&(delete x[p.id],_.__h.trigger({type:"change",action:"remove",mode:"drag",node:p.c}))}},__aI:function(a){if(1===a.which){var _=this;_.__aO={x:a.pageX,y:a.pageY};var e=_.__h,t=e.offset();_.__aN={x:t.left,y:t.top,width:e.width(),height:e.height()},_.__aQ={},g.__aG(),e.trigger("dragbegin"),i.begin(a.target,function(a){_.__aS(a)},function(a){_.__aT(a)})}},__aS:function(a){var _=this;if(!_.__aJ){var e=_.__aO;(Math.abs(a.pageX-e.x)>5||Math.abs(a.pageY-e.y)>5)&&(_.__aJ=!0)}_.__aJ&&(_.__aP||(_.__aP=_.__aM()),_.__aU=a,_.__aV(),_.__aR(a))},__aT:function(){var a=this;a.__aW(),g.__ax(),delete a.__aU,delete a.__aO,delete a.__aN,delete a.__aP,delete a.__aQ,a.__h.trigger("dragfinish")},__aV:function(){var a=this;a.__aX||(a.__aX=function(){var _=0,e=0,t=a.__aU,i=d.scrollTop(),n=d.height(),h=o.height(),r=o.width(),g=d.width(),c=d.scrollLeft();t.pageX-c<20&&c>0?_=-Math.min(7,c):c+g-t.pageX<20&&c+g<r&&(_=Math.min(7,r-g-c)),t.pageY-i<20&&i>0?e=-Math.min(7,i):i+n-t.pageY<20&&i+n<h&&(e=Math.min(7,h-n-i)),(_||e)&&(t.pageX+=_,t.pageY+=e,a.__aR(t),window.scrollBy(_,e))},n.__aY(30,a.__aX))},__aW:function(){var a=this;a.__aX&&(n.__aZ(a.__aX),delete a.__aX)}})});