define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],function(_,e,t){var i=_("magix"),a=_("../mx-dragdrop/index"),n=_("../mx-runner/index"),h=_("$");i.applyStyle("_m","._cg{left:-1000px;top:0;background:#d45414;position:absolute;opacity:.3;border:1px solid #7c2c0a}");var d=i.guid("area_"),r=h(window),o=h(document),g={__aS:function(){var _=h("#"+d);_.length||(_=h('<div id="'+d+'" class="_cg" />').appendTo("body"))},__aT:function(_,e,t,i){h("#"+d).css({left:_,top:e,width:t,height:i})},__aJ:function(){h("#"+d).css({left:-1e5})}},c=function(_,e){var t=_.width/2,i=_.height/2,a=e.width/2,n=e.height/2,h={x:_.x+t,y:_.y+i},d={x:e.x+a,y:e.y+n};return Math.abs(d.x-h.x)<=t+a&&Math.abs(d.y-h.y)<=i+n};t.exports=i.View.extend({init:function(_){var e=this,t=h("#"+e.id);t.on("mousedown",function(_){_.preventDefault(),e.__aU(_)}),t.on("click",function(_){if(!e.__aV){var i=e.__aW(_.target);i&&t.trigger({type:"change",action:"add",mode:"click",node:i})}delete e.__aV}),e.on("destroy",function(){t.off("mousedown click")}),e.__aX=_.selector,e.__h=t},__aW:function(_){for(var e=this,t=null,i=e.__h[0];i!=_;){if(_.parentNode==i){t=_;break}_=_.parentNode}return t&&e.__aX&&(h.find.matchesSelector(t,e.__aX)||(t=null)),t},__aY:function(){for(var _=this,e=[],t=0,i=0,a=_.__aX?_.__h.find(_.__aX):_.__h.children();i<a.length;i++){var n=a[i],d=h(n),r=d.offset();e.push({id:t++,c:n,x:r.left,y:r.top,width:d.width(),height:d.height()})}return e},__bc:function(_){var e=this,t={x:_.pageX,y:_.pageY},i=e.__aZ;t.x<i.x?t.x=i.x:t.x>i.x+i.width&&(t.x=i.x+i.width),t.y<i.y?t.y=i.y:t.y>i.y+i.height&&(t.y=i.y+i.height);var a=e.__b_,n=Math.min(t.x,a.x),h=Math.min(t.y,a.y),d=Math.abs(t.x-a.x),r=Math.abs(t.y-a.y);g.__aT(n,h,d,r);for(var o=e.__ba,b={x:n,y:h,width:d,height:r},f=e.__bb,x=0,l=o;x<l.length;x++){var s=l[x];c(b,s)?1!==f[s.id]&&(f[s.id]=1,e.__h.trigger({type:"change",action:"add",mode:"drag",node:s.c})):1===f[s.id]&&(delete f[s.id],e.__h.trigger({type:"change",action:"remove",mode:"drag",node:s.c}))}},__aU:function(_){if(1===_.which){var e=this;e.__b_={x:_.pageX,y:_.pageY};var t=e.__h,i=t.offset();e.__aZ={x:i.left,y:i.top,width:t.width(),height:t.height()},e.__bb={},g.__aS(),t.trigger("dragbegin"),a.begin(_.target,function(_){e.__bd(_)},function(_){e.__be(_)})}},__bd:function(_){var e=this;if(!e.__aV){var t=e.__b_;(Math.abs(_.pageX-t.x)>5||Math.abs(_.pageY-t.y)>5)&&(e.__aV=!0)}e.__aV&&(e.__ba||(e.__ba=e.__aY()),e.__bf=_,e.__bg(),e.__bc(_))},__be:function(){var _=this;_.__bh(),g.__aJ(),delete _.__bf,delete _.__b_,delete _.__aZ,delete _.__ba,delete _.__bb,_.__h.trigger("dragfinish")},__bg:function(){var _=this;_.__bi||(_.__bi=function(){var e=0,t=0,i=_.__bf,a=r.scrollTop(),n=r.height(),h=o.height(),d=o.width(),g=r.width(),c=r.scrollLeft();i.pageX-c<20&&c>0?e=-Math.min(7,c):c+g-i.pageX<20&&c+g<d&&(e=Math.min(7,d-g-c)),i.pageY-a<20&&a>0?t=-Math.min(7,a):a+n-i.pageY<20&&a+n<h&&(t=Math.min(7,h-n-a)),(e||t)&&(i.pageX+=e,i.pageY+=t,_.__bc(i),window.scrollBy(e,t))},n.__bj(30,_.__bi))},__bh:function(){var _=this;_.__bi&&(n.__bk(_.__bi),delete _.__bi)}})});