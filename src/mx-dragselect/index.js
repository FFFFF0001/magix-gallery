define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],function(_,e,t){var i=_("magix"),a=_("../mx-dragdrop/index"),n=_("../mx-runner/index"),d=_("$");i.applyStyle("_m","._cg{left:-1000px;top:0;background:#d45414;position:absolute;opacity:.3;border:1px solid #7c2c0a}");var r=i.guid("area_"),h=d(window),o=d(document),g={__aT:function(){var _=d("#"+r);_.length||(_=d('<div id="'+r+'" class="_cg" />').appendTo("body"))},__aU:function(_,e,t,i){d("#"+r).css({left:_,top:e,width:t,height:i})},__aK:function(){d("#"+r).css({left:-1e5})}},c=function(_,e){var t=_.width/2,i=_.height/2,a=e.width/2,n=e.height/2,d={x:_.x+t,y:_.y+i},r={x:e.x+a,y:e.y+n};return Math.abs(r.x-d.x)<=t+a&&Math.abs(r.y-d.y)<=i+n};t.exports=i.View.extend({init:function(_){var e=this,t=d("#"+e.id);t.on("mousedown",function(_){_.preventDefault(),e.__aV(_)}),t.on("click",function(_){if(!e.__aW){var i=e.__aX(_.target);i&&t.trigger({type:"change",action:"add",mode:"click",node:i})}delete e.__aW}),e.on("destroy",function(){t.off("mousedown click")}),e.__aY=_.selector,e.__i=t},__aX:function(_){for(var e=this,t=null,i=e.__i[0];i!=_;){if(_.parentNode==i){t=_;break}_=_.parentNode}return t&&e.__aY&&(d.find.matchesSelector(t,e.__aY)||(t=null)),t},__aZ:function(){for(var _=this,e=[],t=0,i=0,a=_.__aY?_.__i.find(_.__aY):_.__i.children();i<a.length;i++){var n=a[i],r=d(n),h=r.offset();e.push({id:t++,c:n,x:h.left,y:h.top,width:r.width(),height:r.height()})}return e},__bd:function(_){var e=this,t={x:_.pageX,y:_.pageY},i=e.__b_;t.x<i.x?t.x=i.x:t.x>i.x+i.width&&(t.x=i.x+i.width),t.y<i.y?t.y=i.y:t.y>i.y+i.height&&(t.y=i.y+i.height);var a=e.__ba,n=Math.min(t.x,a.x),d=Math.min(t.y,a.y),r=Math.abs(t.x-a.x),h=Math.abs(t.y-a.y);g.__aU(n,d,r,h);for(var o=e.__bb,b={x:n,y:d,width:r,height:h},f=e.__bc,l=0,x=o;l<x.length;l++){var s=x[l];c(b,s)?1!==f[s.id]&&(f[s.id]=1,e.__i.trigger({type:"change",action:"add",mode:"drag",node:s.c})):1===f[s.id]&&(delete f[s.id],e.__i.trigger({type:"change",action:"remove",mode:"drag",node:s.c}))}},__aV:function(_){if(1===_.which){var e=this;e.__ba={x:_.pageX,y:_.pageY};var t=e.__i,i=t.offset();e.__b_={x:i.left,y:i.top,width:t.width(),height:t.height()},e.__bc={},g.__aT(),t.trigger("dragbegin"),a.begin(_.target,function(_){e.__be(_)},function(_){e.__bf(_)})}},__be:function(_){var e=this;if(!e.__aW){var t=e.__ba;(Math.abs(_.pageX-t.x)>5||Math.abs(_.pageY-t.y)>5)&&(e.__aW=!0)}e.__aW&&(e.__bb||(e.__bb=e.__aZ()),e.__bg=_,e.__bh(),e.__bd(_))},__bf:function(){var _=this;_.__bi(),g.__aK(),delete _.__bg,delete _.__ba,delete _.__b_,delete _.__bb,delete _.__bc,_.__i.trigger("dragfinish")},__bh:function(){var _=this;_.__bj||(_.__bj=function(){var e=0,t=0,i=_.__bg,a=h.scrollTop(),n=h.height(),d=o.height(),r=o.width(),g=h.width(),c=h.scrollLeft();i.pageX-c<20&&c>0?e=-Math.min(7,c):c+g-i.pageX<20&&c+g<r&&(e=Math.min(7,r-g-c)),i.pageY-a<20&&a>0?t=-Math.min(7,a):a+n-i.pageY<20&&a+n<d&&(t=Math.min(7,d-n-a)),(e||t)&&(i.pageX+=e,i.pageY+=t,_.__bd(i),window.scrollBy(e,t))},n.__bk(30,_.__bj))},__bi:function(){var _=this;_.__bj&&(n.__bl(_.__bj),delete _.__bj)}})});