define("mx-dragselect/index",["magix","../mx-dragdrop/index","../mx-runner/index","$"],(e,_,t)=>{let a=e("magix"),i=e("../mx-dragdrop/index"),h=e("../mx-runner/index"),d=e("$");a.applyStyle("_m","._cf{left:-1000px;top:0;background:#5665eb;position:absolute;opacity:.3;border:1px solid #4d4fa8}");let l=a.guid("area_"),g=d(window),n=d(document),o={__aP(){let e=d("#"+l);e.length||(e=d('<div id="'+l+'" class="_cf" />').appendTo("body"))},__aQ(e,_,t,a){d("#"+l).css({left:e,top:_,width:t,height:a})},__aG(){d("#"+l).css({left:-1e5})}},r=(e,_)=>{let t=e.width/2,a=e.height/2,i=_.width/2,h=_.height/2,d={x:e.x+t,y:e.y+a},l={x:_.x+i,y:_.y+h};return Math.abs(l.x-d.x)<=t+i&&Math.abs(l.y-d.y)<=a+h};t.exports=a.View.extend({init(e){let _=this,t=d("#"+_.id);t.on("mousedown",e=>{e.preventDefault(),_.__aR(e)}),t.on("click",e=>{if(!_.__aS){let a=_.__aT(e.target);a&&t.trigger({type:"change",action:"add",mode:"click",node:a})}delete _.__aS}),_.on("destroy",()=>{t.off("mousedown click")}),_.__aU=e.selector,_.__h=t},__aT(e){let _=this,t=null,a=_.__h[0];for(;a!=e;){if(e.parentNode==a){t=e;break}e=e.parentNode}return t&&_.__aU&&(d.find.matchesSelector(t,_.__aU)||(t=null)),t},__aV(){let e=this.__aU?this.__h.find(this.__aU):this.__h.children(),_=[],t=0;for(let a of e){let e=d(a),i=e.offset();_.push({id:t++,c:a,x:i.left,y:i.top,width:e.width(),height:e.height()})}return _},__b_(e){let _=this,t={x:e.pageX,y:e.pageY},a=_.__aW;t.x<a.x?t.x=a.x:t.x>a.x+a.width&&(t.x=a.x+a.width),t.y<a.y?t.y=a.y:t.y>a.y+a.height&&(t.y=a.y+a.height);let i=_.__aX,h=Math.min(t.x,i.x),d=Math.min(t.y,i.y),l=Math.abs(t.x-i.x),g=Math.abs(t.y-i.y);o.__aQ(h,d,l,g);let n=_.__aY,s={x:h,y:d,width:l,height:g},x=_.__aZ;for(let e of n)r(s,e)?1!==x[e.id]&&(x[e.id]=1,_.__h.trigger({type:"change",action:"add",mode:"drag",node:e.c})):1===x[e.id]&&(delete x[e.id],_.__h.trigger({type:"change",action:"remove",mode:"drag",node:e.c}))},__aR(e){if(1===e.which){let _=this;_.__aX={x:e.pageX,y:e.pageY};let t=_.__h,a=t.offset();_.__aW={x:a.left,y:a.top,width:t.width(),height:t.height()},_.__aZ={},o.__aP(),t.trigger("dragbegin"),i.begin(e.target,e=>{_.__ba(e)},e=>{_.__bb(e)})}},__ba(e){let _=this;if(!_.__aS){let t=_.__aX;(Math.abs(e.pageX-t.x)>5||Math.abs(e.pageY-t.y)>5)&&(_.__aS=!0)}_.__aS&&(_.__aY||(_.__aY=_.__aV()),_.__bc=e,_.__bd(),_.__b_(e))},__bb(){let e=this;e.__be(),o.__aG(),delete e.__bc,delete e.__aX,delete e.__aW,delete e.__aY,delete e.__aZ,e.__h.trigger("dragfinish")},__bd(){let e=this;e.__bf||(e.__bf=(()=>{let _=0,t=0,a=e.__bc,i=g.scrollTop(),h=g.height(),d=n.height(),l=n.width(),o=g.width(),r=g.scrollLeft();a.pageX-r<20&&r>0?_=-Math.min(7,r):r+o-a.pageX<20&&r+o<l&&(_=Math.min(7,l-o-r)),a.pageY-i<20&&i>0?t=-Math.min(7,i):i+h-a.pageY<20&&i+h<d&&(t=Math.min(7,d-h-i)),(_||t)&&(a.pageX+=_,a.pageY+=t,e.__b_(a),window.scrollBy(_,t))}),h.__bg(30,e.__bf))},__be(){let e=this;e.__bf&&(h.__bh(e.__bf),delete e.__bf)}})});