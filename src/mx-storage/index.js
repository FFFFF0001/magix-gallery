define("mx-storage/index",["magix"],(e,t,_)=>{let a,i,r,o=e("magix"),s={},n=!1,l={};i="localStorage";let d=()=>{let e=(+new Date).toString(),t=JSON.stringify(l);s.__ep=t,s.__eq=e,"__er"==i&&(r.setAttribute("__eq",e),r.setAttribute("__ep",t),r.save("__es"))},c=o.mix({set(e,t){l[e]=t,d()},get:e=>l[e],del(e){delete l[e],d()}},o.Event);if(i in window)try{localStorage.setItem(i,o.guid()),n=!0,localStorage.removeItem(i)}catch(e){}if(n)s=localStorage,a=s.__eq;else if((i="globalStorage")in window)try{let e=window[i];s="localhost"==location.hostname?e.__et:e[location.hostname],a=s.__eq}catch(e){}else if((r=document.createElement("link")).addBehavior){r.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(r);try{r.load("__es")}catch(e){r.setAttribute("__es","{}"),r.save("__es"),r.load("__es")}let e="{}";try{e=r.getAttribute("__es"),a=r.getAttribute("__eq")}catch(e){}i="__er",s.__ep=e}let g=()=>{var e;clearTimeout(g.timer),g.timer=setTimeout(function(){if("__er"==i){r.load("__es");try{e=r.getAttribute("__eq")}catch(e){}}else e=s.__eq;if(e&&e!=a){a=e;let t,_="{}";if("__er"==i){r.load("__es");try{_=r.getAttribute("__es")}catch(e){}s.__ep=_}t=JSON.parse(s.__ep);let n=o.keys(l).concat(o.keys(t)),d={};for(let e of n)if(1!==d[e]){d[e]=1;let _=JSON.stringify(l[e]);JSON.stringify(t[e])!=_&&c.fire("change",{key:e,from:l[e],to:t[e]})}l=t}},25)};if("addEventListener"in window&&window.addEventListener("pageshow",e=>{e.persisted&&g()},!1),"__er"==i?setInterval(g,1e3):"addEventListener"in window?window.addEventListener("storage",g,!1):document.attachEvent("onstorage",g),s.__ep)try{l=JSON.parse(s.__ep)}catch(e){s.__ep="{}"}else s.__ep="{}";_.exports=c});