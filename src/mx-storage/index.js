define("mx-storage/index",["magix"],function(e,t,a){var i,_,n,r=e("magix"),o={},c=!1,d={};_="localStorage";var s=function(){var e=(+new Date).toString(),t=JSON.stringify(d);o.__eb=t,o.__ec=e,"__ed"==_&&(n.setAttribute("__ec",e),n.setAttribute("__eb",t),n.save("__ee"))},l=r.mix({set:function(e,t){d[e]=t,s()},get:function(e){return d[e]},del:function(e){delete d[e],s()}},r.Event);if(_ in window)try{localStorage.setItem(_,r.guid()),c=!0,localStorage.removeItem(_)}catch(e){}if(c)o=localStorage,i=o.__ec;else if((_="globalStorage")in window)try{var f=window[_];o="localhost"==location.hostname?f.__ef:f[location.hostname],i=o.__ec}catch(e){}else if((n=document.createElement("link")).addBehavior){n.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(n);try{n.load("__ee")}catch(e){n.setAttribute("__ee","{}"),n.save("__ee"),n.load("__ee")}var g="{}";try{g=n.getAttribute("__ee"),i=n.getAttribute("__ec")}catch(e){}_="__ed",o.__eb=g}var u=function(){var e;clearTimeout(u.timer),u.timer=setTimeout(function(){if("__ed"==_){n.load("__ee");try{e=n.getAttribute("__ec")}catch(e){}}else e=o.__ec;if(e&&e!=i){i=e;var t=void 0,a="{}";if("__ed"==_){n.load("__ee");try{a=n.getAttribute("__ee")}catch(e){}o.__eb=a}t=JSON.parse(o.__eb);for(var c={},s=0,f=r.keys(d).concat(r.keys(t));s<f.length;s++){var g=f[s];if(1!==c[g]){c[g]=1;var u=JSON.stringify(d[g]);JSON.stringify(t[g])!=u&&l.fire("change",{key:g,from:d[g],to:t[g]})}}d=t}},25)};if("addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&u()},!1),"__ed"==_?setInterval(u,1e3):"addEventListener"in window?window.addEventListener("storage",u,!1):document.attachEvent("onstorage",u),o.__eb)try{d=JSON.parse(o.__eb)}catch(e){o.__eb="{}"}else o.__eb="{}";a.exports=l});