define("mx-hour/week",["magix","$","../mx-monitor/index","./index"],function(e,a,t){var i=e("magix"),d=e("$"),_=e("../mx-monitor/index");i.applyStyle("_v","._do{padding:0;height:38.4px;text-align:center}._dp{text-align:left;padding-left:10px}._dq{border:none}._dr{border-right:1px solid #e6e6e6}._ds{visibility:hidden}._dt:hover ._ds{visibility:visible}._du{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;padding:10px;margin-top:10px;z-index:10}._dv{margin-bottom:10px;width:300px;border-bottom:1px solid #e6e6e6}._dw{margin:0 25px 10px 0}._dx{visibility:visible}");var s=e("./index"),n="111111111111111111111111",r="000000000000000000000000",c=function(e){var a=0;for(e=(e=(e+"").split(",")).slice(a,7);a<7;)e[a]=s.improve(e[a]),a++;return e};t.exports=i.View.extend({tmpl:{html:'<div mx-guid="g0" class="_du" id="dlg_<%=$$.viewId%>"><div mx-guid="g1" class="_dv">2</div><div><button type="button" class="_am _an" mx-click="__cw()">确认</button><button type="button" mx-click="__cv()" class="_am _s">取消</button></div></div><table class="_W"><thead><tr><th class="_do" width="100">快捷设置</th><th colspan="2" class="_do _dp"><label class="_t"><input mx-guid="g2" class="_as" type="radio" mx-change="__ct({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>> 全日程投放</label><label class="_v"><input mx-guid="g3" class="_as" type="radio" mx-change="__ct({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>> 工作日（周一至周五）投放</label><label class="_v"><input mx-guid="g4" class="_as" type="radio" mx-change="__ct({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>> 休息日（周六、周日）投放</label></th></tr><tr><th class="_do">时间</th><th class="_do"><table class="_W"><tbody><tr><%for(var b=0;b<24;b++){%><td class="_do _dq<%if(b<23){%> _dr<%}%>"><%=(\'0\'+b).slice(-2)%></td><%}%></tr></tbody></table></th><th width="80" class="_do">操作</th></tr></thead><tbody mx-guid="g6">4</tbody></table>',subs:[{keys:["viewId"],path:'div[mx-guid="g0"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{keys:["days","currentClone"],path:'div[mx-guid="g1"]',tmpl:'<%for(var a=0;a<$$.days.length;a++){%><label class="_dw<%if(a==$$.currentClone){%> _al<%}%>"><input class="_h" type="checkbox" value="<%=a%>" <%if(a==$$.currentClone){%> disabled<%}%>>周<%=$$.days.charAt(a)%></label><%}%>',s:"2"},{keys:["viewId","allDays"],path:'input[mx-guid="g2"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="g3"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="g4"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["days","viewId"],path:'tbody[mx-guid="g6"]',tmpl:'<%for(var c=0;c<$$.days.length;c++){%><tr class="_dt"><td class="_do _ac" mx-click="__aq({day:<%=c%>})">周<%=$$.days.charAt(c)%></td><td class="_do"><table class="_W"><tbody id="hours_<%=$$.viewId%>_<%=c%>" mx-view="mx-hour/index?border=no" mx-change="__cn({day:<%=c%>})"></tbody></table></td><td class="_do"><div class="_ds"><a mx-click="__cu({day:<%=c%>})" href="#">复制到</a></div></td></tr><%}%>',s:"4"}]},init:function(e){var a=this;a.__ar=c(e.days||[r,r,r,r,r,r,r]),_.__d(),a.__h=d("#"+a.id),a.on("destroy",function(){_.__f(a),_.__g()})},render:function(){var e=this;e.updater.digest({viewId:e.id,days:"一二三四五六日"}),e.val(e.__ar)},__i:function(e){var a=this,t=i.inside(e,"dlg_"+a.id);if(!t&&a.__cq){var d=a.__cq.parent();t=i.inside(e,d[0])}return t},__cr:function(){var e=this,a=e.__ar.slice(0,5).join(""),t=e.__ar.slice(-2).join(""),i=a.indexOf("1")>-1,d=t.indexOf("1")>-1,_=-1==a.indexOf("0"),s=-1==t.indexOf("0"),n=_&&s;e.updater.digest({allDays:n,weekdays:!d&&_,weekends:s&&!i})},__cs:function(){for(var e=this,a=e.__ar,t=0,d=void 0,_=void 0;t<a.length;t++)d=a[t],(_=i.Vframe.get("hours_"+e.id+"_"+t))&&_.invoke("val",[d])},val:function(e){var a=this;return e&&(a.__ar=c(e),a.__cs(),a.__cr()),a.__ar},__e:function(){var e=this;if(!e.__j){e.__j=!0,_.__k(e);var a=e.__cq,t=d("#dlg_"+e.id);t.show();var i=a.offset(),s=i.left+a.outerWidth()-t.outerWidth(),n=i.top+a.outerHeight()+10;t.offset({left:s,top:n}),a.parent().addClass("_dx")}},__a:function(){var e=this;if(e.__j){e.__j=!1,_.__f(e),d("#dlg_"+e.id).hide();var a=e.__cq;a&&a.parent().removeClass("_dx")}},__u:function(){var e=this,a=e.__ar;e.__h.val(a).trigger({type:"change",days:a})},"__ct<change>":function(e){var a=this;switch(e.stopPropagation(),e.params.type){case 0:a.__ar=[n,n,n,n,n,n,n];break;case 1:a.__ar=[n,n,n,n,n,r,r];break;case 2:a.__ar=[r,r,r,r,r,n,n]}a.__cr(),a.__cs(),a.__u()},"__cn<change>":function(e){e.stopPropagation();var a=this;a.__ar[e.params.day]=e.range,clearTimeout(a.__ci),a.__ci=setTimeout(a.wrapAsync(function(){a.__cr()}),100),a.__u()},"__aq<click>":function(e){var a=e.params.day,t=this,d=i.Vframe.get("hours_"+t.id+"_"+a);d&&(d.invoke("val").indexOf("0")>-1?d.invoke("val",[t.__ar[a]=n]):d.invoke("val",[t.__ar[a]=r]),t.__cr(),t.__u())},"__cu<click>":function(e){e.preventDefault();var a=this,t=d(e.eventTarget);a.__cq=t,a.__e(),a.updater.digest({currentClone:e.params.day})},"__cv<click>":function(){this.__a()},"__cw<click>":function(){var e=this,a=e.updater.get("currentClone"),t=e.__ar[a];d("#dlg_"+e.id+" input:checked").each(function(a,i){e.__ar[i.value]=t}),e.__a(),e.__cs(),e.__cr()}})});