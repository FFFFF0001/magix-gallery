define("mx-hour/week",["magix","$","../mx-monitor/index","./index"],(e,t,a)=>{let _=e("magix"),d=e("$"),i=e("../mx-monitor/index");_.applyStyle("_v","._ds{padding:0;height:38.4px;text-align:center}._dt{text-align:left;padding-left:10px}._du{border:none}._dv{border-right:1px solid #e6e6e6}._dw{visibility:hidden}._dx:hover ._dw{visibility:visible}._dy{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;padding:10px;margin-top:10px;z-index:10}._dz{margin-bottom:10px;width:300px;border-bottom:1px solid #e6e6e6}._dA{margin:0 25px 10px 0}._dB{visibility:visible}");let s=e("./index"),l="111111111111111111111111",c="000000000000000000000000",n=e=>{let t=0;for(e=(e=(e+"").split(",")).slice(t,7);t<7;)e[t]=s.improve(e[t]),t++;return e};a.exports=_.View.extend({tmpl:{html:'<div mx-guid="g0" class="_dy" id="dlg_<%=$$.viewId%>"><div mx-guid="g1" class="_dz">2</div><div><button type="button" class="_an _ao" mx-click="__cF()">确认</button><button type="button" mx-click="__cE()" class="_an _s">取消</button></div></div><table class="_W"><thead><tr><th class="_ds" width="100">快捷设置</th><th colspan="2" class="_ds _dt"><label class="_t"><input mx-guid="g2" class="_at" type="radio" mx-change="__cC({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>> 全日程投放</label><label class="_v"><input mx-guid="g3" class="_at" type="radio" mx-change="__cC({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>> 工作日（周一至周五）投放</label><label class="_v"><input mx-guid="g4" class="_at" type="radio" mx-change="__cC({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>> 休息日（周六、周日）投放</label></th></tr><tr><th class="_ds">时间</th><th class="_ds"><table class="_W"><tbody><tr><%for(var a=0;a<24;a++){%><td class="_ds _du<%if(a<23){%> _dv<%}%>"><%=(\'0\'+a).slice(-2)%></td><%}%></tr></tbody></table></th><th width="80" class="_ds">操作</th></tr></thead><tbody mx-guid="g6">4</tbody></table>',subs:[{keys:["viewId"],path:'div[mx-guid="g0"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{keys:["days","currentClone"],path:'div[mx-guid="g1"]',tmpl:'<%for(var _=0;_<$$.days.length;_++){%><label class="_dA<%if(_==$$.currentClone){%> _am<%}%>"><input class="_h" type="checkbox" value="<%=_%>" <%if(_==$$.currentClone){%> disabled<%}%>>周<%=$$.days.charAt(_)%></label><%}%>',s:"2"},{keys:["viewId","allDays"],path:'input[mx-guid="g2"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="g3"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="g4"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["days","viewId"],path:'tbody[mx-guid="g6"]',tmpl:'<%for(var b=0;b<$$.days.length;b++){%><tr class="_dx"><td class="_ds _ad" mx-click="__ax({day:<%=b%>})">周<%=$$.days.charAt(b)%></td><td class="_ds"><table class="_W"><tbody id="hours_<%=$$.viewId%>_<%=b%>" mx-view="mx-hour/index?border=no" mx-change="__cw({day:<%=b%>})"></tbody></table></td><td class="_ds"><div class="_dw"><a mx-click="__cD({day:<%=b%>})" href="#">复制到</a></div></td></tr><%}%>',s:"4"}]},init(e){let t=this;t.__ay=n(e.days||[c,c,c,c,c,c,c]),i.__d(),t.__h=d("#"+t.id),t.on("destroy",()=>{i.__f(t),i.__g()})},render(){this.updater.digest({viewId:this.id,days:"一二三四五六日"}),this.val(this.__ay)},__i(e){let t=this,a=_.inside(e,"dlg_"+t.id);if(!a&&t.__cz){let d=t.__cz.parent();a=_.inside(e,d[0])}return a},__cA(){let e=this.__ay.slice(0,5).join(""),t=this.__ay.slice(-2).join(""),a=e.indexOf("1")>-1,_=t.indexOf("1")>-1,d=-1==e.indexOf("0"),i=-1==t.indexOf("0"),s=d&&i;this.updater.digest({allDays:s,weekdays:!_&&d,weekends:i&&!a})},__cB(){let e=this,t=e.__ay;for(let a,d,i=0;i<t.length;i++)a=t[i],(d=_.Vframe.get("hours_"+e.id+"_"+i))&&d.invoke("val",[a])},val(e){let t=this;return e&&(t.__ay=n(e),t.__cB(),t.__cA()),t.__ay},__e(){let e=this;if(!e.__j){e.__j=!0,i.__k(e);let t=e.__cz,a=d("#dlg_"+e.id);a.show();let _=t.offset(),s=_.left+t.outerWidth()-a.outerWidth(),l=_.top+t.outerHeight()+10;a.offset({left:s,top:l}),t.parent().addClass("_dB")}},__a(){let e=this;if(e.__j){e.__j=!1,i.__f(e),d("#dlg_"+e.id).hide();let t=e.__cz;t&&t.parent().removeClass("_dB")}},__u(){let e=this.__ay;this.__h.val(e).trigger({type:"change",days:e})},"__cC<change>"(e){let t=this;switch(e.stopPropagation(),e.params.type){case 0:t.__ay=[l,l,l,l,l,l,l];break;case 1:t.__ay=[l,l,l,l,l,c,c];break;case 2:t.__ay=[c,c,c,c,c,l,l]}t.__cA(),t.__cB(),t.__u()},"__cw<change>"(e){e.stopPropagation();let t=this;t.__ay[e.params.day]=e.range,clearTimeout(t.__cr),t.__cr=setTimeout(t.wrapAsync(()=>{t.__cA()}),100),t.__u()},"__ax<click>"(e){let t=e.params.day,a=this,d=_.Vframe.get("hours_"+a.id+"_"+t);if(d){d.invoke("val").indexOf("0")>-1?d.invoke("val",[a.__ay[t]=l]):d.invoke("val",[a.__ay[t]=c]),a.__cA(),a.__u()}},"__cD<click>"(e){e.preventDefault();let t=d(e.eventTarget);this.__cz=t,this.__e(),this.updater.digest({currentClone:e.params.day})},"__cE<click>"(){this.__a()},"__cF<click>"(){let e=this,t=e.updater.get("currentClone"),a=e.__ay[t];d("#dlg_"+e.id+" input:checked").each((t,_)=>{e.__ay[_.value]=a}),e.__a(),e.__cB(),e.__cA()}})});