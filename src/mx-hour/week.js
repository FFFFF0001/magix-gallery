define("mx-hour/week",["magix","$","../mx-monitor/index","./index"],function(e,t,a){var i=e("magix"),d=e("$"),_=e("../mx-monitor/index");i.applyStyle("_v","._dt{padding:0;height:38.4px;text-align:center}._du{text-align:left;padding-left:10px}._dv{border:none}._dw{border-right:1px solid #e6e6e6}._dx{visibility:hidden}._dy:hover ._dx{visibility:visible}._dz{position:absolute;display:none;background-color:#fff;border:1px solid #e6e6e6;border-radius:4px;padding:10px;margin-top:10px;z-index:10}._dA{margin-bottom:10px;width:300px;border-bottom:1px solid #e6e6e6}._dB{margin:0 25px 10px 0}._dC{visibility:visible}");var s=e("./index"),n="111111111111111111111111",c="000000000000000000000000",r=function(e){var t=0;for(e=(e=(e+"").split(",")).slice(t,7);t<7;)e[t]=s.improve(e[t]),t++;return e};a.exports=i.View.extend({tmpl:{html:'<div mx-guid="g0" class="_dz" id="dlg_<%=$$.viewId%>"><div mx-guid="g1" class="_dA">2</div><div><button type="button" class="_an _ao" mx-click="__cI()">确认</button><button type="button" mx-click="__cH()" class="_an _s">取消</button></div></div><table class="_W"><thead><tr><th class="_dt" width="100">快捷设置</th><th colspan="2" class="_dt _du"><label class="_t"><input mx-guid="g2" class="_at" type="radio" mx-change="__cF({type:0})" name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>> 全日程投放</label><label class="_v"><input mx-guid="g3" class="_at" type="radio" mx-change="__cF({type:1})" name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>> 工作日（周一至周五）投放</label><label class="_v"><input mx-guid="g4" class="_at" type="radio" mx-change="__cF({type:2})" name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>> 休息日（周六、周日）投放</label></th></tr><tr><th class="_dt">时间</th><th class="_dt"><table class="_W"><tbody><tr><%for(var b=0;b<24;b++){%><td class="_dt _dv<%if(b<23){%> _dw<%}%>"><%=(\'0\'+b).slice(-2)%></td><%}%></tr></tbody></table></th><th width="80" class="_dt">操作</th></tr></thead><tbody mx-guid="g6">4</tbody></table>',subs:[{keys:["viewId"],path:'div[mx-guid="g0"]',attr:'id="dlg_<%=$$.viewId%>"',attrs:[{n:"id",p:1}]},{keys:["days","currentClone"],path:'div[mx-guid="g1"]',tmpl:'<%for(var a=0;a<$$.days.length;a++){%><label class="_dB<%if(a==$$.currentClone){%> _am<%}%>"><input class="_h" type="checkbox" value="<%=a%>" <%if(a==$$.currentClone){%> disabled<%}%>>周<%=$$.days.charAt(a)%></label><%}%>',s:"2"},{keys:["viewId","allDays"],path:'input[mx-guid="g2"]',attr:'name="st-<%=$$.viewId%>" <%if($$.allDays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekdays"],path:'input[mx-guid="g3"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekdays){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["viewId","weekends"],path:'input[mx-guid="g4"]',attr:'name="st-<%=$$.viewId%>" <%if($$.weekends){%> checked<%}%>',attrs:[{n:"name",p:1},{n:"checked",b:1,p:1}]},{keys:["days","viewId"],path:'tbody[mx-guid="g6"]',tmpl:'<%for(var c=0;c<$$.days.length;c++){%><tr class="_dy"><td class="_dt _ad" mx-click="__aA({day:<%=c%>})">周<%=$$.days.charAt(c)%></td><td class="_dt"><table class="_W"><tbody id="hours_<%=$$.viewId%>_<%=c%>" mx-view="mx-hour/index?border=no" mx-change="__cz({day:<%=c%>})"></tbody></table></td><td class="_dt"><div class="_dx"><a mx-click="__cG({day:<%=c%>})" href="#">复制到</a></div></td></tr><%}%>',s:"4"}]},init:function(e){var t=this;t.__aB=r(e.days||[c,c,c,c,c,c,c]),_.__d(),t.__h=d("#"+t.id),t.on("destroy",function(){_.__f(t),_.__g()})},render:function(){var e=this;e.updater.digest({viewId:e.id,days:"一二三四五六日"}),e.val(e.__aB)},__i:function(e){var t=this,a=i.inside(e,"dlg_"+t.id);if(!a&&t.__cC){var d=t.__cC.parent();a=i.inside(e,d[0])}return a},__cD:function(){var e=this,t=e.__aB.slice(0,5).join(""),a=e.__aB.slice(-2).join(""),i=t.indexOf("1")>-1,d=a.indexOf("1")>-1,_=-1==t.indexOf("0"),s=-1==a.indexOf("0"),n=_&&s;e.updater.digest({allDays:n,weekdays:!d&&_,weekends:s&&!i})},__cE:function(){for(var e=this,t=e.__aB,a=0,d=void 0,_=void 0;a<t.length;a++)d=t[a],(_=i.Vframe.get("hours_"+e.id+"_"+a))&&_.invoke("val",[d])},val:function(e){var t=this;return e&&(t.__aB=r(e),t.__cE(),t.__cD()),t.__aB},__e:function(){var e=this;if(!e.__j){e.__j=!0,_.__k(e);var t=e.__cC,a=d("#dlg_"+e.id);a.show();var i=t.offset(),s=i.left+t.outerWidth()-a.outerWidth(),n=i.top+t.outerHeight()+10;a.offset({left:s,top:n}),t.parent().addClass("_dC")}},__a:function(){var e=this;if(e.__j){e.__j=!1,_.__f(e),d("#dlg_"+e.id).hide();var t=e.__cC;t&&t.parent().removeClass("_dC")}},__u:function(){var e=this,t=e.__aB;e.__h.val(t).trigger({type:"change",days:t})},"__cF<change>":function(e){var t=this;switch(e.stopPropagation(),e.params.type){case 0:t.__aB=[n,n,n,n,n,n,n];break;case 1:t.__aB=[n,n,n,n,n,c,c];break;case 2:t.__aB=[c,c,c,c,c,n,n]}t.__cD(),t.__cE(),t.__u()},"__cz<change>":function(e){e.stopPropagation();var t=this;t.__aB[e.params.day]=e.range,clearTimeout(t.__cu),t.__cu=setTimeout(t.wrapAsync(function(){t.__cD()}),100),t.__u()},"__aA<click>":function(e){var t=e.params.day,a=this,d=i.Vframe.get("hours_"+a.id+"_"+t);d&&(d.invoke("val").indexOf("0")>-1?d.invoke("val",[a.__aB[t]=n]):d.invoke("val",[a.__aB[t]=c]),a.__cD(),a.__u())},"__cG<click>":function(e){e.preventDefault();var t=this,a=d(e.eventTarget);t.__cC=a,t.__e(),t.updater.digest({currentClone:e.params.day})},"__cH<click>":function(){this.__a()},"__cI<click>":function(){var e=this,t=e.updater.get("currentClone"),a=e.__aB[t];d("#dlg_"+e.id+" input:checked").each(function(t,i){e.__aB[i.value]=a}),e.__a(),e.__cE(),e.__cD()}})});