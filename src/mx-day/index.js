define("mx-day/index",["magix","$","mx-dropdown/index","./month"],(e,t,a)=>{e("mx-dropdown/index"),e("./month");let _=e("magix"),s=e("$");_.applyStyle("_j","._bK{padding:0;height:38.4px}._bL{border:none}._bM{border-right:1px solid #e6e6e6}");let d=(e,t)=>{let a=t[e];if(!a){a=[];for(let e=12;e--;)a[e]="";t[e]=a}return a},i=[{key:"MON",day:"一"},{key:"TUE",day:"二"},{key:"WED",day:"三"},{key:"THU",day:"四"},{key:"FRI",day:"五"},{key:"SAT",day:"六"},{key:"SUN",day:"日"}];a.exports=_.View.extend({tmpl:{html:'<table class="_W"><thead><tr><th class="_bK _a_" width="120">周期设置</th><th mx-guid="g0" class="_bK _Z" colspan="31">1</th></tr><tr><th class="_bK _a_"><div mx-guid="g1" mx-change="__as()" style="width:100px" class="_g _s" mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"></div></th><th colspan="31" class="_bK"><table class="_W _X"><tbody><tr><%for(var a=0;a<31;a++){%><td class="_bK _a_ _bL<%if(a<30){%> _bM<%}%>"><%=(\'0\'+(a+1)).slice(-2)%></td><%}%></tr></tbody></table></th></tr></thead><tbody mx-guid="g3">4</tbody></table>',subs:[{keys:["weeks","viewId"],path:'th[mx-guid="g0"]',tmpl:'<%for(var _=0;_<$$.weeks.length;_++){%><label class="_h _t"><input mx-change="__au({key:\'<%=$eq($$.weeks[_].key)%>\'})" id="<%=$$.viewId%>_<%=$$.weeks[_].key%>" type="checkbox" class="_as">每周<%=$$.weeks[_].day%></label><%}%>',s:"1"},{keys:["years","selectedYear"],path:'div[mx-guid="g1"]',attr:'mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"',attrs:[{n:"mx-view",v:1}]},{keys:["viewId","selectedYear","days"],path:'tbody[mx-guid="g3"]',tmpl:'<%for(var b=0;b<12;b++){%><tr><td class="_bK _ad _a_" mx-click="__ax({m:<%!b%>})"><%=(\'0\'+(b+1)).slice(-2)%></td><td class="_bK" colspan="31" id="months_<%=b%>_<%=$$.viewId%>" mx-change="__aw({m:<%!b%>})" mx-sync="__aw({m:<%!b%>})" mx-view="mx-day/month?year=<%!$eu($$.selectedYear)%>&month=<%!$eu(b)%>&selected=<%!$eu($$.days[b])%>"></td></tr><%}%>',s:"4"}]},init(e){this.assign(e);let t=s("#"+this.id);this.__h=t},assign(e){return this.__an=e.years,this.__ao=e.selectedYear||e.years[0],this.__ap=(e=>{e=e||{};for(let t in e){let a=e[t];(a=((a=a||"")+"").split(",")).length>12&&(a=a.slice(0,12));for(let e=0;e<12;e++)a[e]||(a[e]="");e[t]=a}return e})(e.selectedDays),!0},render(){let e=this,t=e.__ao,a=d(t,e.__ap);e.updater.digest({viewId:e.id,weeks:i,years:e.__an,selectedYear:t,days:a})},__ar(){let e={};for(let t=i.length;t--;)e[i[t].key]=1;let t=this;t.__h.find('[mx-view*="mx-day/month"]').each((t,a)=>{let _=a.vframe.invoke("__aq");for(let t=_.length;t--;)delete e[_[t]]});for(let a=i.length;a--;){let _=i[a].key;s("#"+t.id+"_"+_).prop("checked",!!e[_])}},"__as<change>"(e){e.stopPropagation();let t=d(e.value,this.__ap);this.updater.digest({days:t,selectedYear:this.__ao=e.value})},__u(){let e=this.__ap;this.__h.val(e).trigger({type:"change",days:e})},"__au<change>"(e){e.stopPropagation();this.__h.find('[mx-view*="mx-day/month"]').each((t,a)=>{let _=a.vframe;_&&_.invoke("__at",[e.params.key,e.eventTarget.checked])}),this.__u()},"__aw<change,sync>"(e){e.stopPropagation();let t=this;d(t.__ao,t.__ap)[e.params.m]=e.days,e.ignoreSync||(clearTimeout(t.__av),t.__av=setTimeout(()=>{t.__ar()},20)),"change"==e.type&&t.__u()},"__ax<click>"(e){let t=e.params.m,a=s("#months_"+t+"_"+this.id),_=d(this.__ao,this.__ap)[t];_=new Array(_.length+1).join(_.indexOf("0")>-1?"1":0),a.invokeView("__p",[_]),this.__u()}})});