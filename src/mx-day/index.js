define("mx-day/index",["magix","$","mx-dropdown/index","./month"],function(e,a,t){e("mx-dropdown/index"),e("./month");var _=e("magix"),s=e("$");_.applyStyle("_j","._bL{padding:0;height:38.4px}._bM{border:none}._bN{border-right:1px solid #e6e6e6}");var r=function(e,a){var t=a[e];if(!t){t=[];for(var _=12;_--;)t[_]="";a[e]=t}return t},i=function(e){e=e||{};for(var a in e){var t=e[a];(t=((t=t||"")+"").split(",")).length>12&&(t=t.slice(0,12));for(var _=0;_<12;_++)t[_]||(t[_]="");e[a]=t}return e},d=[{key:"MON",day:"一"},{key:"TUE",day:"二"},{key:"WED",day:"三"},{key:"THU",day:"四"},{key:"FRI",day:"五"},{key:"SAT",day:"六"},{key:"SUN",day:"日"}];t.exports=_.View.extend({tmpl:{html:'<table class="_W"><thead><tr><th class="_bL _a_" width="120">周期设置</th><th mx-guid="g0" class="_bL _Z" colspan="31">1</th></tr><tr><th class="_bL _a_"><div mx-guid="g1" mx-change="__av()" style="width:100px" class="_g _s" mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"></div></th><th colspan="31" class="_bL"><table class="_W _X"><tbody><tr><%for(var b=0;b<31;b++){%><td class="_bL _a_ _bM<%if(b<30){%> _bN<%}%>"><%=(\'0\'+(b+1)).slice(-2)%></td><%}%></tr></tbody></table></th></tr></thead><tbody mx-guid="g3">4</tbody></table>',subs:[{keys:["weeks","viewId"],path:'th[mx-guid="g0"]',tmpl:'<%for(var a=0;a<$$.weeks.length;a++){%><label class="_h _t"><input mx-change="__ax({key:\'<%=$eq($$.weeks[a].key)%>\'})" id="<%=$$.viewId%>_<%=$$.weeks[a].key%>" type="checkbox" class="_as">每周<%=$$.weeks[a].day%></label><%}%>',s:"1"},{keys:["years","selectedYear"],path:'div[mx-guid="g1"]',attr:'mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"',attrs:[{n:"mx-view",v:1}]},{keys:["viewId","selectedYear","days"],path:'tbody[mx-guid="g3"]',tmpl:'<%for(var c=0;c<12;c++){%><tr><td class="_bL _ad _a_" mx-click="__aA({m:<%!c%>})"><%=(\'0\'+(c+1)).slice(-2)%></td><td class="_bL" colspan="31" id="months_<%=c%>_<%=$$.viewId%>" mx-change="__az({m:<%!c%>})" mx-sync="__az({m:<%!c%>})" mx-view="mx-day/month?year=<%!$eu($$.selectedYear)%>&month=<%!$eu(c)%>&selected=<%!$eu($$.days[c])%>"></td></tr><%}%>',s:"4"}]},init:function(e){var a=this;a.assign(e);var t=s("#"+a.id);a.__h=t},assign:function(e){var a=this;return a.__aq=e.years,a.__ar=e.selectedYear||e.years[0],a.__as=i(e.selectedDays),!0},render:function(){var e=this,a=e.__ar,t=r(a,e.__as);e.updater.digest({viewId:e.id,weeks:d,years:e.__aq,selectedYear:a,days:t})},__au:function(){for(var e={},a=d.length;a--;)e[d[a].key]=1;var t=this;t.__h.find('[mx-view*="mx-day/month"]').each(function(a,t){for(var _=t.vframe.invoke("__at"),s=_.length;s--;)delete e[_[s]]});for(a=d.length;a--;){var _=d[a].key;s("#"+t.id+"_"+_).prop("checked",!!e[_])}},"__av<change>":function(e){e.stopPropagation();var a=this,t=r(e.value,a.__as);a.updater.digest({days:t,selectedYear:a.__ar=e.value})},__u:function(){var e=this;e.__h.trigger({type:"change",days:e.__as})},"__ax<change>":function(e){var a=this;e.stopPropagation(),a.__h.find('[mx-view*="mx-day/month"]').each(function(a,t){var _=t.vframe;_&&_.invoke("__aw",[e.params.key,e.eventTarget.checked])}),a.__u()},"__az<change,sync>":function(e){e.stopPropagation();var a=this;r(a.__ar,a.__as)[e.params.m]=e.days,e.ignoreSync||(clearTimeout(a.__ay),a.__ay=setTimeout(function(){a.__au()},20)),"change"==e.type&&a.__u()},"__aA<click>":function(e){var a=this,t=e.params.m,_=s("#months_"+t+"_"+a.id),i=r(a.__ar,a.__as)[t];i=new Array(i.length+1).join(i.indexOf("0")>-1?"1":0),_.invokeView("__p",[i]),a.__u()}})});