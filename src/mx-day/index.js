define("mx-day/index",["magix","$","mx-dropdown/index","./month"],function(e,a,t){e("mx-dropdown/index"),e("./month");var _=e("magix"),s=e("$");_.applyStyle("_j","._bL{padding:0;height:38.4px}._bM{border:none}._bN{border-right:1px solid #e6e6e6}");var i=function(e,a){var t=a[e];if(!t){t=[];for(var _=12;_--;)t[_]="";a[e]=t}return t},d=function(e){e=e||{};for(var a in e){var t=e[a];(t=((t=t||"")+"").split(",")).length>12&&(t=t.slice(0,12));for(var _=0;_<12;_++)t[_]||(t[_]="");e[a]=t}return e},r=[{key:"MON",day:"一"},{key:"TUE",day:"二"},{key:"WED",day:"三"},{key:"THU",day:"四"},{key:"FRI",day:"五"},{key:"SAT",day:"六"},{key:"SUN",day:"日"}];t.exports=_.View.extend({tmpl:{html:'<table class="_W"><thead><tr><th class="_bL _a_" width="120">周期设置</th><th mx-guid="g0" class="_bL _Z" colspan="31">1</th></tr><tr><th class="_bL _a_"><div mx-guid="g1" mx-change="__aw()" style="width:100px" class="_g _s" mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"></div></th><th colspan="31" class="_bL"><table class="_W _X"><tbody><tr><%for(var b=0;b<31;b++){%><td class="_bL _a_ _bM<%if(b<30){%> _bN<%}%>"><%=(\'0\'+(b+1)).slice(-2)%></td><%}%></tr></tbody></table></th></tr></thead><tbody mx-guid="g3">4</tbody></table>',subs:[{keys:["weeks","viewId"],path:'th[mx-guid="g0"]',tmpl:'<%for(var a=0;a<$$.weeks.length;a++){%><label class="_h _t"><input mx-change="__ay({key:\'<%=$eq($$.weeks[a].key)%>\'})" id="<%=$$.viewId%>_<%=$$.weeks[a].key%>" type="checkbox" class="_as">每周<%=$$.weeks[a].day%></label><%}%>',s:"1"},{keys:["years","selectedYear"],path:'div[mx-guid="g1"]',attr:'mx-view="mx-dropdown/index?list=<%@$$.years%>&selected=<%!$eu($$.selectedYear)%>"',attrs:[{n:"mx-view",v:1}]},{keys:["viewId","selectedYear","days"],path:'tbody[mx-guid="g3"]',tmpl:'<%for(var c=0;c<12;c++){%><tr><td class="_bL _ad _a_" mx-click="__aB({m:<%!c%>})"><%=(\'0\'+(c+1)).slice(-2)%></td><td class="_bL" colspan="31" id="months_<%=c%>_<%=$$.viewId%>" mx-change="__aA({m:<%!c%>})" mx-sync="__aA({m:<%!c%>})" mx-view="mx-day/month?year=<%!$eu($$.selectedYear)%>&month=<%!$eu(c)%>&selected=<%!$eu($$.days[c])%>"></td></tr><%}%>',s:"4"}]},init:function(e){var a=this;a.assign(e);var t=s("#"+a.id);a.__i=t},assign:function(e){var a=this;return a.__ar=e.years,a.__as=e.selectedYear||e.years[0],a.__at=d(e.selectedDays),!0},render:function(){var e=this,a=e.__as,t=i(a,e.__at);e.updater.digest({viewId:e.id,weeks:r,years:e.__ar,selectedYear:a,days:t})},__av:function(){for(var e={},a=r.length;a--;)e[r[a].key]=1;var t=this;t.__i.find('[mx-view*="mx-day/month"]').each(function(a,t){for(var _=t.vframe.invoke("__au"),s=_.length;s--;)delete e[_[s]]});for(a=r.length;a--;){var _=r[a].key;s("#"+t.id+"_"+_).prop("checked",!!e[_])}},"__aw<change>":function(e){e.stopPropagation();var a=this,t=i(e.value,a.__at);a.updater.digest({days:t,selectedYear:a.__as=e.value})},__v:function(){var e=this;e.__i.trigger({type:"change",days:e.__at})},"__ay<change>":function(e){var a=this;e.stopPropagation(),a.__i.find('[mx-view*="mx-day/month"]').each(function(a,t){var _=t.vframe;_&&_.invoke("__ax",[e.params.key,e.eventTarget.checked])}),a.__v()},"__aA<change,sync>":function(e){e.stopPropagation();var a=this;i(a.__as,a.__at)[e.params.m]=e.days,e.ignoreSync||(clearTimeout(a.__az),a.__az=setTimeout(function(){a.__av()},20)),"change"==e.type&&a.__v()},"__aB<click>":function(e){var a=this,t=e.params.m,_=s("#months_"+t+"_"+a.id),d=i(a.__as,a.__at)[t];d=new Array(d.length+1).join(d.indexOf("0")>-1?"1":0),_.invokeView("__q",[d]),a.__v()}})});