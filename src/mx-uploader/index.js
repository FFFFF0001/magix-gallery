define("mx-uploader/index",["magix","$","../mx-runner/index"],function(e,t,n){var r=e("magix"),i=e("$"),o=e("../mx-runner/index");r.applyStyle("_O","._fH{position:relative;overflow:hidden}._fI{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}._fJ,._fI{position:absolute}._fJ{left:-999999px}");var a=r.Base.extend({destroy:function(){this.__do=1}}),p=a.extend({__gf:function(e,t,n,a){var p=e.form,f=this,d=r.guid("up");p||(i("body").append('<div id="'+d+'_temp" class="_fJ"><form target="'+d+'"></form></div>'),(p=i("#"+d+"_temp").find("form")).append(e),p=p[0]);var c=0,s=2e3;if(e.files){s=0;for(var l=0;l<e.files.length;l++)s+=e.files[l].size;(s/=1e3)<2e3&&(s=2e3)}var u=1e3/s,m=function(){c<1&&(a(c),c+=u+20*Math.random()*u)};o.__bj(100,m),i('<iframe name="'+d+'" id="'+d+'" style="display:none;"></iframe>').insertAfter(p).on("load",function(e){if(o.__bk(m),!f.__do){a(1);var t=e.target,r=i(t.contentWindow.document.body);r.find("script").remove();var p=i.trim(r.text());i(t).remove(),i("#"+d+"_temp").remove();try{n(null,new Function("return "+p)())}catch(e){n(e)}}}).on("error",function(e){o.__bk(m),f.__do||(i("#"+d+"_temp").remove(),n(e))}),p.target=d,p.action=t.get("action"),p.method="POST",p.enctype="multipart/form-data",p.submit()}}),f=a.extend({__gf:function(e,t,n,r){for(var i=new FormData,o=this,a=e.files,p=0;p<a.length;p++)i.append(t.get("name"),a[p]);var f=new XMLHttpRequest;f.open("post",t.get("action"),!0),f.onload=function(){if(!o.__do)try{n(null,new Function("return "+f.responseText)())}catch(e){n(e)}},f.onerror=function(e){o.__do||(e.message="network error",n(e))},f.upload.onprogress=function(e){r(e.lengthComputable?e.loaded/e.total:0)},f.send(i)}});n.exports=r.View.extend({init:function(e){var t=this;t.updater.set({name:e.name||"file",action:e.action||"",multiple:e.multiple,accept:e.accept});var n;n=window.FormData?f:p,t.capture("__gg",new n)},render:function(){var e=this,t="file_"+e.id,n=i("#"+t);n.length&&n.remove();var r=e.updater.get();i("#"+e.id).append(e.wrapEvent('<input id="'+t+'" type="file" class="_fI" mx-change="__gh()" name="'+r.name+'" />')).addClass("_fH"),n=i("#"+t),r.multiple&&n.attr("multiple","multiple"),r.accept&&n.prop("accept",r.accept)},"__gh<change>":function(e){var t=this,n=i("#"+t.id),r=e.eventTarget.files,o=i.Event("start",{files:r});n.trigger(o),o.isDefaultPrevented()?t.render():(t.capture("__gg").__gf(e.target,t.updater,function(e,t){e?n.trigger({type:"error",error:e}):n.trigger({type:"success",files:r,response:t})},function(e){n.trigger({type:"progress",percent:e})}),t.render())}})});