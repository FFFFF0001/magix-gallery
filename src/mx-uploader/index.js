define("mx-uploader/index",["magix","$","../mx-runner/index"],(e,t,r)=>{let i=e("magix"),n=e("$"),l=e("../mx-runner/index");i.applyStyle("_P","._fI{position:relative;overflow:hidden}._fJ{left:0;top:0;bottom:0;right:0;width:100%;height:100%;opacity:0;cursor:pointer;font-size:100px;filter:alpha(opacity=0)}._fK,._fJ{position:absolute}._fK{left:-999999px}");let o=i.Base.extend({destroy(){this.__dl=1}}),a=o.extend({__gj(e,t,r,o){let a=e.form,p=this,d=i.guid("up");if(!a){n("body").append('<div id="'+d+'_temp" class="_fK"><form target="'+d+'"></form></div>');(a=n("#"+d+"_temp").find("form")).append(e),a=a[0]}let s=0,m=2e3;if(e.files){m=0;for(let t=0;t<e.files.length;t++)m+=e.files[t].size;(m/=1e3)<2e3&&(m=2e3)}let _=1e3/m,f=()=>{s<1&&(o(s),s+=_+20*Math.random()*_)};l.__bg(100,f),n('<iframe name="'+d+'" id="'+d+'" style="display:none;"></iframe>').insertAfter(a).on("load",e=>{if(l.__bh(f),!p.__dl){o(1);let t=e.target,i=n(t.contentWindow.document.body);i.find("script").remove();let l=n.trim(i.text());n(t).remove(),n("#"+d+"_temp").remove();try{r(null,new Function("return "+l)())}catch(e){r(e)}}}).on("error",e=>{l.__bh(f),p.__dl||(n("#"+d+"_temp").remove(),r(e))}),a.target=d,a.action=t.get("action"),a.method="POST",a.enctype="multipart/form-data",a.submit()}}),p=o.extend({__gj(e,t,r,i){let n=new FormData,l=this,o=e.files;for(let e=0;e<o.length;e++)n.append(t.get("name"),o[e]);let a=new XMLHttpRequest;a.open("post",t.get("action"),!0),a.onload=(()=>{if(!l.__dl)try{r(null,new Function("return "+a.responseText)())}catch(e){r(e)}}),a.onerror=(e=>{l.__dl||(e.message="network error",r(e))}),a.upload.onprogress=(e=>{i(e.lengthComputable?e.loaded/e.total:0)}),a.send(n)}});r.exports=i.View.extend({init(e){this.updater.set({name:e.name||"file",action:e.action||"",multiple:e.multiple,accept:e.accept});let t;t=window.FormData?p:a,this.capture("__gk",new t)},render(){let e="file_"+this.id,t=n("#"+e);t.length&&t.remove();let r=this.updater.get();n("#"+this.id).append(this.wrapEvent('<input id="'+e+'" type="file" class="_fJ" mx-change="__gl()" name="'+r.name+'" />')).addClass("_fI"),t=n("#"+e),r.multiple&&t.attr("multiple","multiple"),r.accept&&t.prop("accept",r.accept)},"__gl<change>"(e){let t=this,r=n("#"+t.id),i=e.eventTarget.files,l=n.Event("start",{files:i});if(r.trigger(l),l.isDefaultPrevented())return void t.render();t.capture("__gk").__gj(e.target,t.updater,(e,t)=>{e?r.trigger({type:"error",error:e}):r.trigger({type:"success",files:i,response:t})},e=>{r.trigger({type:"progress",percent:e})}),t.render()}})});